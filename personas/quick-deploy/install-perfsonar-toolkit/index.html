
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://osg-htc.org/networking/personas/quick-deploy/install-perfsonar-toolkit/">
      
      
        <link rel="prev" href="../install-perfsonar-testpoint/">
      
      
        <link rel="next" href="../automated-setup/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Install Toolkit (RPM) - OSG Networking Area</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","UA-69012-29"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","UA-69012-29",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=UA-69012-29",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installing-a-perfsonar-toolkit-for-wlcgosg" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OSG Networking Area" class="md-header__button md-logo" aria-label="OSG Networking Area" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OSG Networking Area
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Install Toolkit (RPM)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/osg-htc/networking/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../landing/" class="md-tabs__link">
          
  
  
  Get Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../perfsonar-in-osg/" class="md-tabs__link">
          
  
  
  perfSONAR Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../perfsonar/tools_scripts/fasterdata-tuning/" class="md-tabs__link">
          
  
  
  Host Tuning

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../troubleshoot/triage-checklist/" class="md-tabs__link">
          
  
  
  Troubleshooting

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../perfsonar/psetf/" class="md-tabs__link">
          
  
  
  Network Services & Data

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../perfsonar/tools_scripts/" class="md-tabs__link">
          
  
  
  Tools & Scripts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../features/fail2ban/" class="md-tabs__link">
          
  
  
  Advanced

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OSG Networking Area" class="md-nav__button md-logo" aria-label="OSG Networking Area" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OSG Networking Area
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/osg-htc/networking/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Get Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Get Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploy perfSONAR
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshoot Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understand the System
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    perfSONAR Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    perfSONAR Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar-in-osg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Why perfSONAR in OSG/WLCG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/deployment-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Installation Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Installation Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploy perfSONAR
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--active"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install-perfsonar-testpoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install Testpoint (Container)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Install Toolkit (RPM)
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Install Toolkit (RPM)
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#choosing-between-toolkit-and-testpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Choosing Between Toolkit and Testpoint
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Choosing Between Toolkit and Testpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-perfsonar-toolkit-this-guide-if-you-need" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use perfSONAR Toolkit (this guide) if you need
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-perfsonar-testpoint-instead-if-you-prefer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use perfSONAR Testpoint instead if you prefer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites-and-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites and Planning
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#existing-perfsonar-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Existing perfSONAR configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-install-and-harden-el9" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1 – Install and Harden EL9
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-install-perfsonar-toolkit-via-rpm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2 – Install perfSONAR Toolkit via RPM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2 – Install perfSONAR Toolkit via RPM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-21-configure-dnf-repositories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2.1 – Configure DNF Repositories
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-22-install-perfsonar-toolkit-bundle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2.2 – Install perfSONAR Toolkit Bundle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-23-run-post-install-configuration-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2.3 – Run Post-Install Configuration Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-24-install-helper-scripts-for-pbr-and-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2.4 – Install Helper Scripts for PBR and Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-configure-policy-based-routing-pbr" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3 – Configure Policy-Based Routing (PBR)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3 – Configure Policy-Based Routing (PBR)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safety-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safety Enhancements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-config-file-automatically-or-preview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate config file automatically (or preview)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-changes-in-place-default" class="md-nav__link">
    <span class="md-ellipsis">
      
        Apply changes (in-place default)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Apply changes (in-place default)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-place-apply-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        In-place apply (recommended)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-rebuild-destructive-removes-all-nm-connections-first" class="md-nav__link">
    <span class="md-ellipsis">
      
        Full rebuild (destructive – removes all NM connections first)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-forward-and-reverse-entries-required" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS: forward and reverse entries (required)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-configure-nftables-selinux-and-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4 – Configure nftables, SELinux, and Fail2Ban
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4 – Configure nftables, SELinux, and Fail2Ban">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-customize-security-with-helper-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional: Customize Security with Helper Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installconfigure-additional-custom-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install/configure additional custom options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirm-nftables-state-and-security-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Confirm nftables state and security services
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-start-and-configure-perfsonar-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5 – Start and Configure perfSONAR Services
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 5 – Start and Configure perfSONAR Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-51-verify-perfsonar-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5.1 – Verify perfSONAR Services
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-52-access-the-web-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5.2 – Access the Web Interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-53-configure-automatic-updates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5.3 – Configure Automatic Updates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-install-and-configure-lets-encrypt-ssl-certificates-optional-but-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6 – Install and Configure Let's Encrypt SSL Certificates (Optional but Recommended)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6 – Install and Configure Let&#39;s Encrypt SSL Certificates (Optional but Recommended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-61-prerequisites-for-lets-encrypt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6.1 – Prerequisites for Let's Encrypt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-62-install-certbot" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6.2 – Install Certbot
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-63-obtain-lets-encrypt-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6.3 – Obtain Let's Encrypt Certificate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-64-configure-apache-to-use-lets-encrypt-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6.4 – Configure Apache to Use Let's Encrypt Certificate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-65-configure-automatic-certificate-renewal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6.5 – Configure Automatic Certificate Renewal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-66-monitor-certificate-expiration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6.6 – Monitor Certificate Expiration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-lets-encrypt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting Let's Encrypt
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-configure-and-enroll-in-psconfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 7 – Configure and Enroll in pSConfig
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 7 – Configure and Enroll in pSConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-a-web-ui-configuration-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option A: Web UI Configuration (Recommended)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-b-command-line-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option B: Command Line Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-c-automated-enrollment-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option C: Automated Enrollment Script
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-8-register-and-configure-with-wlcgosg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 8 – Register and Configure with WLCG/OSG
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-9-selinux-troubleshooting-if-enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 9 – SELinux Troubleshooting (If Enabled)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 9 – SELinux Troubleshooting (If Enabled)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selinux-basics-for-perfsonar" class="md-nav__link">
    <span class="md-ellipsis">
      
        SELinux Basics for perfSONAR
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-selinux-issues-and-fixes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common SELinux Issues and Fixes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common SELinux Issues and Fixes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-1-etcperfsonarlsregistrationdaemonconf-has-wrong-label" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 1: /etc/perfsonar/lsregistrationdaemon.conf Has Wrong Label
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-2-other-services-ethtool-df-python3-postgresql-collect2-generating-audit-alerts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 2: Other Services (ethtool, df, python3, postgresql, collect2) Generating Audit Alerts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-3-audit-log-flooding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 3: Audit Log Flooding
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-selinux-with-perfsonar" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices for SELinux with perfSONAR
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-10-post-install-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 10 – Post-Install Validation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ongoing-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ongoing Maintenance
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#networking-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Networking Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Certificate Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perfsonar-service-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        perfSONAR Service Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-update-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Auto-Update Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#general-debugging-tips" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Debugging Tips
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automated-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Automated Setup
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Legacy Installation (Archive)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Host Tuning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Host Tuning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/fasterdata-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fasterdata Host Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/multiple-nic-guidance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiple NIC Guidance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/packet-pacing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Packet Pacing (fq vs tbf)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Troubleshooting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/triage-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Triage Checklist
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../network-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Troubleshooting Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../network-troubleshooting/osg-debugging-document/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OSG Debugging Document
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Playbooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Playbooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/playbooks/container-startup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Container Startup Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/playbooks/tests-not-running/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tests Not Running
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/playbooks/performance-issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/playbooks/firewall-issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Firewall & Network Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Network Services & Data
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Network Services & Data
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/psetf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure Monitoring (PSETF)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../osg-network-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Datastore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../osg-network-analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Analytics Platform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tools & Scripts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tools & Scripts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/fasterdata-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fasterdata Host Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/README-lsregistration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LS Registration Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LS Registration Updater
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/docker-compose.yml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compose Bundles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Link-Check Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/fail2ban/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    fail2ban
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/selinux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SELinux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/nftables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    nftables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quick-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Release Notes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Release Notes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/quick-deploy-1.4.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v1.4.0
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/quick-deploy-1.3.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v1.3.0
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/quick-deploy-1.1.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v1.1.0
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/quick-deploy-1.0.1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v1.0.1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../release-notes/quick-deploy-1.0.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v1.0.0
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../web-site-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Site Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../../perfsonar-in-osg/" class="md-path__link">
          
  <span class="md-ellipsis">
    perfSONAR Guides
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../landing/" class="md-path__link">
          
  <span class="md-ellipsis">
    Installation Guides
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="installing-a-perfsonar-toolkit-for-wlcgosg">Installing a perfSONAR Toolkit for WLCG/OSG<a class="headerlink" href="#installing-a-perfsonar-toolkit-for-wlcgosg" title="Permanent link">&para;</a></h1>
<!-- markdownlint-disable MD040 -->

<p>This guide walks WLCG/OSG site administrators through end-to-end installation, configuration, and validation of a
perfSONAR Toolkit on Enterprise Linux 9 (EL9) using RPM packages. The Toolkit provides a full-featured perfSONAR
installation with a local web interface for configuration and monitoring, plus a local measurement archive for data
storage.</p>
<p>For upstream RPM installation documentation, see: <a href="https://docs.perfsonar.net/install_el.html">https://docs.perfsonar.net/install_el.html</a></p>
<hr />
<h2 id="choosing-between-toolkit-and-testpoint">Choosing Between Toolkit and Testpoint<a class="headerlink" href="#choosing-between-toolkit-and-testpoint" title="Permanent link">&para;</a></h2>
<h3 id="use-perfsonar-toolkit-this-guide-if-you-need">Use perfSONAR Toolkit (this guide) if you need<a class="headerlink" href="#use-perfsonar-toolkit-this-guide-if-you-need" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Local web interface</strong> for configuration, monitoring, and viewing measurement results</li>
<li><strong>Local measurement archive</strong> to store test data on-site with your own retention policies</li>
<li><strong>Full-featured installation</strong> with all perfSONAR capabilities</li>
<li><strong>Site-specific data retention</strong> requirements or regulatory compliance needs</li>
<li><strong>On-site troubleshooting</strong> access to historical measurement data without external dependencies</li>
</ul>
<h3 id="use-perfsonar-testpoint-instead-if-you-prefer">Use perfSONAR Testpoint instead if you prefer<a class="headerlink" href="#use-perfsonar-testpoint-instead-if-you-prefer" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Lightweight container-based</strong> deployment with minimal local resources</li>
<li><strong>Central archiving</strong> where measurements are stored at a remote archive (WLCG/OSG central infrastructure)</li>
<li><strong>Simplified updates</strong> via container image pulls rather than RPM package management</li>
<li><strong>Reduced local storage</strong> requirements (no local measurement archive)</li>
</ul>
<p>See <a href="../install-perfsonar-testpoint/">Installing a perfSONAR Testpoint</a> for the container-based deployment guide.</p>
<hr />
<h2 id="prerequisites-and-planning">Prerequisites and Planning<a class="headerlink" href="#prerequisites-and-planning" title="Permanent link">&para;</a></h2>
<p>Before you begin, it may be helpful to gather the following information:</p>
<ul>
<li>
<p><strong>Hardware details:</strong> hostname, BMC/iLO/iDRAC credentials (if used), interface names, available storage locations.</p>
</li>
<li>
<p><strong>Network data:</strong> IPv4/IPv6 assignments for each NIC, default gateway, internal/external VLAN
  information.</p>
</li>
<li>
<p><strong>Operational contacts:</strong> site admin email, OSG facility/site name, latitude/longitude.</p>
</li>
</ul>
<h2 id="existing-perfsonar-configuration">Existing perfSONAR configuration<a class="headerlink" href="#existing-perfsonar-configuration" title="Permanent link">&para;</a></h2>
<p>If replacing an existing instance, you may want to back up <code>/etc/perfsonar/</code> files, especially
<code>lsregistrationdaemon.conf</code>, and any container volumes. We have a script named<code>perfSONAR-update-lsregistration.sh</code> to
extract/save/restore registration config that you may want to use.</p>
<details class="info">
<summary>Quick capture of existing lsregistration config (if you have a src)</summary>
<p>Download a temp copy: <br />
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-o<span class="w"> </span>/tmp/update-lsreg.sh
chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>/tmp/update-lsreg.sh
</code></pre></div>
Use the downloaded tool to extract a restore script:
<div class="highlight"><pre><span></span><code>/tmp/update-lsreg.sh<span class="w"> </span>extract<span class="w"> </span>--output<span class="w"> </span>/root/restore-lsreg.sh<span class="w"> </span>--local
</code></pre></div>
Note: Repository clone instructions are in Step 2.
<strong>Note:</strong> All shell commands assume an interactive root shell.</p>
</details>
<hr />
<h2 id="step-1-install-and-harden-el9">Step 1 – Install and Harden EL9<a class="headerlink" href="#step-1-install-and-harden-el9" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Provision EL9:</strong> Install AlmaLinux, Rocky Linux, or RHEL 9 with the <em>Minimal</em> profile.</p>
</li>
<li>
<p><strong>Set the hostname and time sync:</strong> Pick the NIC that will own the default route for the hostname.</p>
<div class="highlight"><pre><span></span><code>hostnamectl<span class="w"> </span>set-hostname<span class="w"> </span>&lt;testpoint-hostname&gt;
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>chronyd
timedatectl<span class="w"> </span>set-timezone<span class="w"> </span>&lt;Region/City&gt;
</code></pre></div>
</li>
<li>
<p><strong>Disable unused services:</strong></p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>disable<span class="w"> </span>--now<span class="w"> </span>firewalld<span class="w"> </span>NetworkManager-wait-online
dnf<span class="w"> </span>remove<span class="w"> </span>-y<span class="w"> </span>rsyslog
</code></pre></div>
<details class="info">
<summary>Why disable unused services?</summary>
<p>We recommend disabling unused services during initial provisioning to reduce complexity and avoid unexpected
interference with network and container setup. Services such as <code>firewalld</code>, <code>NetworkManager-wait-online</code>, and <code>rsyslog</code>
can alter networking state, hold boot or network events, or conflict with the automated nftables/NetworkManager changes
performed by the helper scripts. Disabling non-essential services makes the install deterministic, reduces the host
attack surface, and avoids delays or race conditions while configuring policy-based routing, nftables rules, and      <br />
container networking.</p>
</details>
</li>
<li>
<p><strong>Update the system:</strong></p>
<p><code>bash
dnf -y update</code></p>
</li>
<li>
<p><strong>Record NIC names:</strong> Document interface mappings for later PBR configuration.</p>
<div class="highlight"><pre><span></span><code>nmcli<span class="w"> </span>device<span class="w"> </span>status
ip<span class="w"> </span>-br<span class="w"> </span>addr
</code></pre></div>
</li>
</ol>
<hr />
<h2 id="step-2-install-perfsonar-toolkit-via-rpm">Step 2 – Install perfSONAR Toolkit via RPM<a class="headerlink" href="#step-2-install-perfsonar-toolkit-via-rpm" title="Permanent link">&para;</a></h2>
<p>After completing Step 1 (minimal OS hardening), install the perfSONAR Toolkit bundle using RPM packages.</p>
<h3 id="step-21-configure-dnf-repositories">Step 2.1 – Configure DNF Repositories<a class="headerlink" href="#step-21-configure-dnf-repositories" title="Permanent link">&para;</a></h3>
<p>Configure DNF to access EPEL, CRB (CodeReady Builder), and perfSONAR repositories:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install EPEL repository</span>
dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>epel-release

<span class="c1"># Non-RHEL Enable CRB (CodeReady Builder) repository</span>
dnf<span class="w"> </span>config-manager<span class="w"> </span>--set-enabled<span class="w"> </span>crb<span class="w">  </span>
<span class="c1"># --OR--</span>
<span class="c1"># For RHEL Enable access to codeready-builder. </span>
<span class="c1"># NOTE auto-install script from perfSONAR doesn&#39;t set this (tries &quot;crb&quot; above which fails for RHEL)</span>
subscription-manager<span class="w"> </span>repos<span class="w"> </span>--enable<span class="w"> </span>codeready-builder-for-rhel-9-x86_64-rpms

<span class="c1"># Install perfSONAR repository for EL9</span>
dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>http://software.internet2.edu/rpms/el9/x86_64/latest/packages/perfsonar-repo-0.11-1.noarch.rpm

<span class="c1"># Refresh DNF cache</span>
dnf<span class="w"> </span>clean<span class="w"> </span>all
</code></pre></div>
<details class="info">
<summary>What these repositories provide</summary>
<ul>
<li><strong>EPEL</strong> (Extra Packages for Enterprise Linux): Community packages not in base EL9</li>
<li><strong>CRB</strong> (CodeReady Builder): Additional development and build tools</li>
<li><strong>perfSONAR repo</strong>: Official perfSONAR packages maintained by Internet2</li>
</ul>
</details>
<h3 id="step-22-install-perfsonar-toolkit-bundle">Step 2.2 – Install perfSONAR Toolkit Bundle<a class="headerlink" href="#step-22-install-perfsonar-toolkit-bundle" title="Permanent link">&para;</a></h3>
<p>Install the complete toolkit bundle:</p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>perfsonar-toolkit
</code></pre></div>
<p>This bundle automatically includes:</p>
<ul>
<li>Core perfSONAR measurement tools (pScheduler, OWAMP, traceroute, throughput tests)</li>
<li><strong>perfsonar-toolkit-security</strong>: Firewall rules (nftables) and fail2ban configuration</li>
<li><strong>perfsonar-toolkit-sysctl</strong>: Network tuning parameters optimized for measurements</li>
<li><strong>perfsonar-toolkit-systemenv-testpoint</strong>: Automatic updates and logging configuration</li>
<li><strong>Web interface</strong>: Local UI at <code>https://&lt;hostname&gt;/toolkit</code></li>
<li><strong>Measurement archive</strong>: Local OpenSearch and Logstash for storing test results</li>
</ul>
<p>Installation takes approximately 5-10 minutes depending on network speed.</p>
<details class="info">
<summary>Alternative automated installation</summary>
<p>perfSONAR provides a one-line automated installer script:
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://downloads.perfsonar.net/install<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-s<span class="w"> </span>-<span class="w"> </span>toolkit
</code></pre></div></p>
<p>This script performs the same steps as above (configure repos + install bundle).</p>
</details>
<h3 id="step-23-run-post-install-configuration-scripts">Step 2.3 – Run Post-Install Configuration Scripts<a class="headerlink" href="#step-23-run-post-install-configuration-scripts" title="Permanent link">&para;</a></h3>
<p>The toolkit bundle includes configuration scripts that must be run after installation:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Configure system tuning parameters (sysctl)</span>
/usr/lib/perfsonar/scripts/configure_sysctl

<span class="c1"># Configure firewall rules</span>
/usr/lib/perfsonar/scripts/configure_firewall<span class="w"> </span>install
</code></pre></div>
<details class="info">
<summary>What these scripts configure</summary>
<p><strong><code>configure_sysctl</code></strong>:
- TCP congestion control algorithm (htcp instead of reno)
- Maximum TCP buffer sizes for high-bandwidth paths
- Network stack tuning for measurement workloads
- Creates <code>/etc/sysctl.d/perfsonar-sysctl.conf</code></p>
<p><strong><code>configure_firewall</code></strong>:
- Opens required ports for perfSONAR services (pScheduler, OWAMP, HTTP/HTTPS)
- Configures nftables rules (compatible with existing rules)
- Enables fail2ban with perfSONAR jails
- Creates <code>/etc/nftables.d/perfsonar.nft</code></p>
</details>
<h3 id="step-24-install-helper-scripts-for-pbr-and-management">Step 2.4 – Install Helper Scripts for PBR and Management<a class="headerlink" href="#step-24-install-helper-scripts-for-pbr-and-management" title="Permanent link">&para;</a></h3>
<p>Install OSG/WLCG helper scripts for policy-based routing and advanced configuration:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install base packages for helper scripts</span>
dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>jq<span class="w"> </span>curl<span class="w"> </span>tar<span class="w"> </span>gzip<span class="w"> </span>rsync<span class="w"> </span>bind-utils<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>python3<span class="w"> </span>iproute<span class="w"> </span>iputils<span class="w"> </span>procps-ng<span class="w"> </span>sed<span class="w"> </span>grep<span class="w"> </span>gawk

<span class="c1"># Bootstrap helper scripts</span>
curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/install_tools_scripts.sh<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>/tmp/install_tools_scripts.sh

chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>/tmp/install_tools_scripts.sh

/tmp/install_tools_scripts.sh<span class="w"> </span>/opt/perfsonar-toolkit
</code></pre></div>
<p><strong>Verify bootstrap completed successfully:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check that all helper scripts were downloaded</span>
ls<span class="w"> </span>-1<span class="w"> </span>/opt/perfsonar-toolkit/tools_scripts/*.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<span class="c1"># Should show 17 shell scripts</span>

<span class="c1"># Verify key scripts are present and executable</span>
ls<span class="w"> </span>-l<span class="w"> </span>/opt/perfsonar-toolkit/tools_scripts/<span class="o">{</span>perfSONAR-pbr-nm.sh,perfSONAR-install-nftables.sh,check-perfsonar-dns.sh,fasterdata-tuning.sh<span class="o">}</span>
</code></pre></div>
<details class="info">
<summary>Why install helper scripts?</summary>
<p>The OSG/WLCG helper scripts provide automation for:
- Multi-NIC policy-based routing configuration
- DNS forward/reverse validation
- Registration information management
- Custom nftables rules integrated with PBR</p>
<p>These scripts are optional but highly recommended for sites with multiple network interfaces or
complex routing requirements.</p>
</details>
<hr />
<h2 id="step-3-configure-policy-based-routing-pbr">Step 3 – Configure Policy-Based Routing (PBR)<a class="headerlink" href="#step-3-configure-policy-based-routing-pbr" title="Permanent link">&para;</a></h2>
<p>The script <code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-pbr-nm.sh</code> automates NetworkManager profiles and routing rule
setup. It fills out and consumes the network configuration in <code>/etc/perfSONAR-multi-nic-config.conf</code>.</p>
<details class="info">
<summary>Modes of operation</summary>
<p>By default the script now performs an <strong>in-place apply</strong> that adjusts routes, rules, and NetworkManager connection
properties <strong>without deleting existing connections or flushing all system routes</strong>. This minimizes disruption and
usually avoids the need for a reboot.</p>
<p>An optional destructive mode <code>--rebuild-all</code> performs the original full workflow: backup existing profiles, flush all
routes and rules, remove every NetworkManager connection, then recreate connections from scratch. Use this only for
initial deployments or when you must completely reset inconsistent legacy state.</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Flag</th>
<th>Disruption</th>
<th>When to use</th>
</tr>
</thead>
<tbody>
<tr>
<td>In-place (default)</td>
<td>(none) or <code>--apply-inplace</code></td>
<td>Low (interfaces stay up; rules adjusted)</td>
<td>Routine updates, gateway changes, add routes</td>
</tr>
<tr>
<td>Full rebuild</td>
<td><code>--rebuild-all</code></td>
<td>High (connections removed; brief connectivity drop)</td>
<td>First-time setup, severe misconfiguration</td>
</tr>
</tbody>
</table>
</details>
<h3 id="safety-enhancements">Safety Enhancements<a class="headerlink" href="#safety-enhancements" title="Permanent link">&para;</a></h3>
<ul>
<li>Detects active SSH session interface and avoids extra disruption to that NIC in in-place mode.</li>
<li>Prompts are still skipped with <code>--yes</code>.</li>
<li>Dry-run preview supported via <code>--dry-run</code> (combine with <code>--debug</code> for verbose output).</li>
<li>Reboot is <strong>no longer generally required</strong>; only consider one if NetworkManager fails to apply the new rules cleanly.</li>
</ul>
<h3 id="generate-config-file-automatically-or-preview">Generate config file automatically (or preview)<a class="headerlink" href="#generate-config-file-automatically-or-preview" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Gateways required for addresses</p>
<p>Any NIC with an IPv4 address must also have an IPv4 gateway, and any NIC with an IPv6 address must have an IPv6 gateway.
If the generator cannot detect a gateway, it adds a WARNING block to the generated file listing affected NICs. Edit
<code>NIC_IPV4_GWS</code>/<code>NIC_IPV6_GWS</code> accordingly before applying changes.</p>
</div>
<details class="note">
<summary>Gateway prompts</summary>
<p>During generation, the script attempts to detect gateways per-NIC. If a NIC has an IP address but no gateway could be
determined, it will prompt you interactively to enter an IPv4 and/or IPv6 gateway (or <code>-</code> to skip). Prompts are skipped
in non-interactive sessions or when you use <code>--yes</code>. Note, NICs without gateways are assumed to NOT be used for perfSONAR.</p>
</details>
<p>Preview generation (<strong>no changes</strong>):</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-pbr-nm.sh<span class="w"> </span>--generate-config-debug<span class="w">    </span>
</code></pre></div>
<p>Generate and <strong>write</strong> the config file:</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-pbr-nm.sh<span class="w"> </span>--generate-config-auto<span class="w"> </span>
</code></pre></div>
<p>The script writes the config file to <code>/etc/perfSONAR-multi-nic-config.conf</code>. Edit to adjust site-specific values (e.g.,
confirm <code>DEFAULT_ROUTE_NIC</code>, add <code>NIC_IPV4_ADDROUTE</code> entries) and verify the entries.  Next step is to apply the network
changes...</p>
<h3 id="apply-changes-in-place-default">Apply changes (in-place default)<a class="headerlink" href="#apply-changes-in-place-default" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Connect via console for network changes</p>
<p>When applying network changes across an ssh connection, your session may be interrupted.   Please try to run the
perfSONAR-pbr-nm.sh script when connected either directly to the console or by using 'nohup' in front of the script
invocation.</p>
</div>
<h4 id="in-place-apply-recommended">In-place apply (recommended)<a class="headerlink" href="#in-place-apply-recommended" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-pbr-nm.sh<span class="w"> </span>--yes
</code></pre></div>
<details class="info">
<summary>If SSH connection drops during network reconfiguration:</summary>
<ol>
<li>Access via BMC/iLO/iDRAC console or physical console</li>
<li>Review <code>/var/log/perfSONAR-multi-nic-config.log</code> for errors</li>
<li>Check network state with <code>nmcli connection show</code> and <code>ip addr</code></li>
<li>Restore from backup if needed: backups are in <code>/var/backups/nm-connections-&lt;timestamp&gt;/</code></li>
<li>Reapply config after corrections: <code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-pbr-nm.sh --yes</code></li>
</ol>
</details>
<h4 id="full-rebuild-destructive-removes-all-nm-connections-first">Full rebuild (destructive – removes all NM connections first)<a class="headerlink" href="#full-rebuild-destructive-removes-all-nm-connections-first" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-pbr-nm.sh<span class="w"> </span>--rebuild-all<span class="w"> </span>--yes
</code></pre></div>
<p>The policy based routing script logs to <code>/var/log/perfSONAR-multi-nic-config.log</code>. After an in-place apply, a reboot is typically
unnecessary. If connectivity or rules appear inconsistent (<code>ip rule show</code> / <code>ip route</code> mismatch), consider a manual
NetworkManager restart:</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>NetworkManager
</code></pre></div>
<h3 id="dns-forward-and-reverse-entries-required">DNS: forward and reverse entries (required)<a class="headerlink" href="#dns-forward-and-reverse-entries-required" title="Permanent link">&para;</a></h3>
<p>All IP addresses that will be used for perfSONAR testing MUST have DNS entries: a forward (A/AAAA) record and a matching
reverse (PTR) record. This is required so remote test tools and site operators can reliably reach and identify your
host, and because some measurement infrastructure and registration systems perform forward/reverse consistency checks.</p>
<ul>
<li>For single-stack IPv4-only hosts: ensure A and PTR are present and consistent.</li>
<li>For single-stack IPv6-only hosts: ensure AAAA and PTR are present and consistent.</li>
<li>For dual-stack hosts: both IPv4 and IPv6 addresses used for testing must have matching forward and reverse records (A+PTR and AAAA+PTR).</li>
</ul>
<details class="info">
<summary>Run the DNS checker</summary>
<p>To validate forward/reverse DNS for addresses in <code>/etc/perfSONAR-multi-nic-config.conf</code> you can run a script:
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/check-perfsonar-dns.sh
</code></pre></div>
<strong>Notes and automation tips:</strong></p>
<ul>
<li>The script above uses <code>dig</code> (bind-utils package) which is commonly available; you can adapt it
  to use <code>host</code> if preferred.</li>
<li>Run the check as part of your provisioning CI or as a pre-flight check before enabling measurement registration.</li>
<li>For large sites or many addresses, parallelize the checks (xargs -P) or use a small Python
  script that leverages <code>dns.resolver</code> for async checks.</li>
<li>If your PTR returns a hostname with a trailing dot, the script strips it before the forward check.</li>
</ul>
<p>If any addresses fail these checks, correct the DNS zone (forward and/or reverse) and allow DNS propagation before
proceeding with registration and testing.</p>
</details>
<p><strong>Verify the routing policy:</strong></p>
<div class="highlight"><pre><span></span><code>nmcli<span class="w"> </span>connection<span class="w"> </span>show
ip<span class="w"> </span>rule<span class="w"> </span>show
ip<span class="w"> </span>route<span class="w"> </span>show<span class="w"> </span>table<span class="w"> </span>&lt;table-id&gt;
</code></pre></div>
<p>Confirm that non-default interfaces have their own routing tables and that the default interface owns the system default
route.</p>
<hr />
<h2 id="step-4-configure-nftables-selinux-and-fail2ban">Step 4 – Configure nftables, SELinux, and Fail2Ban<a class="headerlink" href="#step-4-configure-nftables-selinux-and-fail2ban" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Toolkit automatic security hardening</p>
<p>The <strong>perfsonar-toolkit</strong> bundle automatically configured security during installation (Step 2):</p>
<ul>
<li><strong>nftables rules</strong> via <code>/usr/lib/perfsonar/scripts/configure_firewall</code></li>
<li><strong>fail2ban</strong> with perfSONAR jails for SSH and service protection</li>
<li><strong>SELinux policies</strong> (if enforcing mode is enabled)</li>
</ul>
<p>This step is <strong>optional</strong> and only needed if you want to:</p>
<ul>
<li>Customize firewall rules beyond the toolkit defaults</li>
<li>Integrate with OSG helper scripts for PBR-derived SSH access control</li>
<li>Add site-specific security policies</li>
</ul>
</div>
<h3 id="optional-customize-security-with-helper-scripts">Optional: Customize Security with Helper Scripts<a class="headerlink" href="#optional-customize-security-with-helper-scripts" title="Permanent link">&para;</a></h3>
<p>Use <code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-install-nftables.sh</code> to configure additional hardened nftables rules
integrated with your PBR configuration. This script can derive SSH allow-lists from your multi-NIC configuration.</p>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>nftables, fail2ban, and SELinux tools are already installed by the perfsonar-toolkit bundle</li>
<li>Multi-NIC configuration file at <code>/etc/perfSONAR-multi-nic-config.conf</code> (from Step 3)</li>
</ul>
<h3 id="installconfigure-additional-custom-options">Install/configure additional custom options<a class="headerlink" href="#installconfigure-additional-custom-options" title="Permanent link">&para;</a></h3>
<p>You can use the install script to install the options you want (selinux, fail2ban).</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-install-nftables.sh<span class="w"> </span>--selinux<span class="w"> </span>--fail2ban<span class="w"> </span>--yes
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">Use</span><span class="w"> </span>`<span class="o">--</span><span class="nv">yes</span>`<span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">skip</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">interactive</span><span class="w"> </span><span class="nv">confirmation</span><span class="w"> </span><span class="nv">prompt</span><span class="w"> </span><span class="ss">(</span><span class="nv">omit</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">prefer</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">review</span><span class="w"> </span><span class="nv">the</span>
<span class="w">  </span><span class="nv">summary</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">answer</span><span class="w"> </span><span class="nv">manually</span><span class="ss">)</span>.

<span class="o">-</span><span class="w"> </span><span class="nv">Add</span><span class="w"> </span>`<span class="o">--</span><span class="nv">dry</span><span class="o">-</span><span class="nv">run</span>`<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">rehearsal</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">prints</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">planned</span><span class="w"> </span><span class="nv">actions</span>.
</code></pre></div>

<p>The script writes nftables rules for perfSONAR services, derives SSH allow-lists from <code>/etc/perfSONAR-multi-nic-
config.conf</code>, optionally adjusts SELinux, and enables Fail2ban jails—only if those components are already installed.</p>
<details class="info">
<summary>SSH allow-lists and validation</summary>
<ul>
<li>Derives SSH allow-lists from <code>/etc/perfSONAR-multi-nic-config.conf</code> (CIDR prefixes and addresses).</li>
<li>Validates nftables rules before writing.</li>
<li>Outputs: rules to <code>/etc/nftables.d/perfsonar.nft</code>, log to <code>/var/log/perfSONAR-install-nftables.log</code>, backups to <code>/var/backups/</code>.</li>
</ul>
</details>
<details class="tip">
<summary>Preview nftables rules before applying</summary>
<p>You can preview the fully rendered nftables rules (no changes are made):</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-install-nftables.sh<span class="w"> </span>--print-rules
</code></pre></div>
</details>
<details class="tip">
<summary>Manually add extra management hosts/subnets</summary>
<p>If you need to allow additional SSH sources not represented by your NIC-derived prefixes, edit
<code>/etc/nftables.d/perfsonar.nft</code> and add entries to the appropriate sets. Example:</p>
<div class="highlight"><pre><span></span><code>set ssh_access_ip4_subnets {
    type ipv4_addr
    flags interval
    elements = { 192.0.2.0/24, 198.51.100.0/25 }
}

set ssh_access_ip4_hosts {
    type ipv4_addr
    elements = { 203.0.113.10, 203.0.113.11 }
}

set ssh_access_ip6_subnets {
    type ipv6_addr
    flags interval
    elements = { 2001:db8:1::/64 }
}

set ssh_access_ip6_hosts {
    type ipv6_addr
    elements = { 2001:db8::10 }
}
</code></pre></div>
<p>Then validate and reload (root shell):</p>
<div class="highlight"><pre><span></span><code>nft<span class="w"> </span>-c<span class="w"> </span>-f<span class="w"> </span>/etc/nftables.d/perfsonar.nft
systemctl<span class="w"> </span>reload<span class="w"> </span>nftables<span class="w"> </span><span class="o">||</span><span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nftables
</code></pre></div>
</details>
<h3 id="confirm-nftables-state-and-security-services">Confirm nftables state and security services<a class="headerlink" href="#confirm-nftables-state-and-security-services" title="Permanent link">&para;</a></h3>
<details class="info">
<summary>Verification commands</summary>
<div class="highlight"><pre><span></span><code>nft<span class="w"> </span>list<span class="w"> </span>ruleset
sestatus
systemctl<span class="w"> </span>status<span class="w"> </span>fail2ban
</code></pre></div>
</details>
<p>You may want to document any site-specific exceptions (e.g., additional allowed management hosts) in your change log.</p>
<hr />
<h2 id="step-5-start-and-configure-perfsonar-services">Step 5 – Start and Configure perfSONAR Services<a class="headerlink" href="#step-5-start-and-configure-perfsonar-services" title="Permanent link">&para;</a></h2>
<p>The perfSONAR Toolkit installation automatically enables and starts all required services. This step verifies service
health and completes first-time web interface configuration.</p>
<h3 id="step-51-verify-perfsonar-services">Step 5.1 – Verify perfSONAR Services<a class="headerlink" href="#step-51-verify-perfsonar-services" title="Permanent link">&para;</a></h3>
<p>Check that all perfSONAR services are running:</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>pscheduler-scheduler
systemctl<span class="w"> </span>status<span class="w"> </span>pscheduler-runner
systemctl<span class="w"> </span>status<span class="w"> </span>pscheduler-archiver
systemctl<span class="w"> </span>status<span class="w"> </span>pscheduler-ticker
systemctl<span class="w"> </span>status<span class="w"> </span>psconfig-pscheduler-agent
systemctl<span class="w"> </span>status<span class="w"> </span>owamp-server
systemctl<span class="w"> </span>status<span class="w"> </span>perfsonar-lsregistrationdaemon
</code></pre></div>
<p>All services should show <code>active (running)</code> status. If any service is not running, start it:</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>&lt;service-name&gt;
</code></pre></div>
<details class="info">
<summary>What each service does</summary>
<ul>
<li><strong>pscheduler-scheduler</strong>: Schedules measurement tests</li>
<li><strong>pscheduler-runner</strong>: Executes scheduled tests</li>
<li><strong>pscheduler-archiver</strong>: Archives measurement results to local and remote stores</li>
<li><strong>pscheduler-ticker</strong>: Manages periodic tasks and cleanup</li>
<li><strong>psconfig-pscheduler-agent</strong>: Processes pSConfig templates and creates scheduled tests</li>
<li><strong>owamp-server</strong>: One-Way Active Measurement Protocol (latency/loss measurements)</li>
<li><strong>perfsonar-lsregistrationdaemon</strong>: Registers this host with the global Lookup Service</li>
</ul>
</details>
<details class="info">
<summary>Additional services (measurement archive)</summary>
<p>The toolkit also runs OpenSearch and Logstash for local measurement archive:
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>opensearch
systemctl<span class="w"> </span>status<span class="w"> </span>logstash
</code></pre></div></p>
<p>These services store measurement results locally for web UI display and historical analysis.</p>
</details>
<p>All services are configured to start automatically on boot via systemd.</p>
<h3 id="step-52-access-the-web-interface">Step 5.2 – Access the Web Interface<a class="headerlink" href="#step-52-access-the-web-interface" title="Permanent link">&para;</a></h3>
<p>The perfSONAR Toolkit provides a comprehensive web interface for configuration and monitoring.</p>
<p><strong>Access the web UI:</strong></p>
<ol>
<li>
<p>Open a browser and navigate to: <code>https://&lt;your-hostname&gt;/toolkit</code></p>
</li>
<li>
<p><strong>First-time setup wizard:</strong></p>
<p>On first access, you'll be guided through initial configuration:</p>
</li>
<li>
<p><strong>Create administrator account</strong>: Set username and password for web UI access</p>
</li>
<li><strong>Administrative information</strong>: Site name, location, contact details</li>
<li><strong>Host information</strong>: Verify hostname, addresses, and network interfaces</li>
<li><strong>Test configuration</strong>: Review default test settings (typically defaults are appropriate)</li>
<li>
<p><strong>Archive settings</strong>: Configure local and/or remote archiving</p>
</li>
<li>
<p><strong>Complete the wizard</strong> to enable full functionality</p>
</li>
</ol>
<details class="tip">
<summary>Web UI features</summary>
<p>The web interface provides:</p>
<ul>
<li><strong>Dashboard</strong>: Real-time and historical measurement results with graphs</li>
<li><strong>Test Configuration</strong>: Schedule on-demand or regular tests to remote endpoints</li>
<li><strong>Administrative Info</strong>: Update site information, contacts, and registration details</li>
<li><strong>Service Health</strong>: Monitor perfSONAR service status and system resources</li>
<li><strong>Archive Configuration</strong>: Manage local archive retention and remote archive destinations</li>
<li><strong>Host Details</strong>: View network interfaces, routes, and system information</li>
</ul>
</details>
<details class="info">
<summary>Accessing web UI remotely</summary>
<p>If you need to access the web UI from outside your local network:</p>
<ul>
<li>Ensure firewall allows HTTPS (port 443) from your management networks</li>
<li>Consider using SSH port forwarding for secure remote access:
  <div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-L<span class="w"> </span><span class="m">8443</span>:localhost:443<span class="w"> </span>root@&lt;perfsonar-host&gt;
</code></pre></div>
  Then access: <code>https://localhost:8443/toolkit</code></li>
</ul>
</details>
<p><strong>Web UI URL:</strong> <code>https://&lt;your-hostname&gt;/toolkit</code></p>
<p>For detailed web UI documentation, see: <a href="https://docs.perfsonar.net/manage_admin_info.html">https://docs.perfsonar.net/manage_admin_info.html</a></p>
<h3 id="step-53-configure-automatic-updates">Step 5.3 – Configure Automatic Updates<a class="headerlink" href="#step-53-configure-automatic-updates" title="Permanent link">&para;</a></h3>
<p>The perfSONAR Toolkit enables automatic updates by default using <code>dnf-automatic</code>.</p>
<p><strong>Verify automatic updates are enabled:</strong></p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>dnf-automatic.timer
</code></pre></div>
<p>The timer should show <code>active</code> and run daily to check for and install perfSONAR package updates.</p>
<p><strong>Manual update check:</strong></p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>check-update<span class="w"> </span>perfsonar<span class="se">\*</span>
</code></pre></div>
<p><strong>Apply updates manually</strong> (if needed):</p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>update<span class="w"> </span>perfsonar<span class="se">\*</span>

<span class="c1"># Restart affected services after updates</span>
systemctl<span class="w"> </span>restart<span class="w"> </span>pscheduler-scheduler<span class="w"> </span>pscheduler-runner<span class="w"> </span>pscheduler-archiver<span class="w"> </span>pscheduler-ticker<span class="w"> </span>psconfig-pscheduler-agent
</code></pre></div>
<details class="info">
<summary>How automatic updates work</summary>
<ul>
<li><strong>dnf-automatic</strong> runs daily (configured in <code>/etc/dnf/automatic.conf</code>)</li>
<li>Updates are downloaded and installed automatically</li>
<li>Security updates are prioritized</li>
<li>Services are restarted as needed by RPM post-install scripts</li>
<li>Update logs: <code>/var/log/dnf.log</code> and <code>journalctl -u dnf-automatic</code></li>
</ul>
</details>
<details class="warning">
<summary>Update behavior</summary>
<p>By default, the toolkit applies updates automatically. If you prefer manual control:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Disable automatic updates</span>
systemctl<span class="w"> </span>disable<span class="w"> </span>dnf-automatic.timer

<span class="c1"># Re-enable later if desired</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>dnf-automatic.timer
</code></pre></div>
<p>Manual updates require regular monitoring to ensure security patches are applied promptly.</p>
</details>
<hr />
<h2 id="step-6-install-and-configure-lets-encrypt-ssl-certificates-optional-but-recommended">Step 6 – Install and Configure Let's Encrypt SSL Certificates (Optional but Recommended)<a class="headerlink" href="#step-6-install-and-configure-lets-encrypt-ssl-certificates-optional-but-recommended" title="Permanent link">&para;</a></h2>
<p>The perfSONAR Toolkit web interface uses HTTPS with self-signed certificates by default. For production deployments,
replacing these with Let's Encrypt certificates provides:</p>
<ul>
<li><strong>Browser trust</strong>: No certificate warnings when accessing the web UI</li>
<li><strong>Security</strong>: Industry-standard encryption with automatic renewals</li>
<li><strong>Compliance</strong>: Meets security requirements for production infrastructure</li>
</ul>
<p>This step is optional but highly recommended for production sites.</p>
<h3 id="step-61-prerequisites-for-lets-encrypt">Step 6.1 – Prerequisites for Let's Encrypt<a class="headerlink" href="#step-61-prerequisites-for-lets-encrypt" title="Permanent link">&para;</a></h3>
<p>Before obtaining Let's Encrypt certificates, ensure:</p>
<ol>
<li><strong>DNS is configured correctly:</strong></li>
</ol>
<p>Your hostname must have valid forward (A/AAAA) and reverse (PTR) DNS records that are publicly resolvable.
   Verify this with the DNS checker:</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/check-perfsonar-dns.sh
</code></pre></div>
<ol>
<li><strong>Port 80 is accessible:</strong></li>
</ol>
<p>Let's Encrypt uses HTTP-01 challenge which requires port 80 to be open from the internet. Update your firewall:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Add HTTP port to nftables (in addition to existing HTTPS)</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-install-nftables.sh<span class="w"> </span>--ports<span class="o">=</span><span class="m">80</span>,443<span class="w"> </span>--yes
</code></pre></div>
<ol>
<li><strong>Apache is not listening on port 80:</strong></li>
</ol>
<p>The perfSONAR Toolkit Apache server should only listen on port 443 (HTTPS). Verify this:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check Apache is only listening on 443, not 80</span>
ss<span class="w"> </span>-tlnp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:80
ss<span class="w"> </span>-tlnp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:443

<span class="c1"># Should show port 443 with httpd, but port 80 should be free</span>
</code></pre></div>
<details class="warning">
<summary>If Apache is listening on port 80</summary>
<p>The Toolkit's Apache configuration should not bind to port 80. If it is, check <code>/etc/httpd/conf/httpd.conf</code> and
<code>/etc/httpd/conf.d/*.conf</code> for <code>Listen 80</code> directives and comment them out:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Find Listen directives</span>
grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;^Listen 80&quot;</span><span class="w"> </span>/etc/httpd/

<span class="c1"># Edit the file(s) and comment out or change to Listen 443</span>
vi<span class="w"> </span>/etc/httpd/conf/httpd.conf

<span class="c1"># Restart Apache</span>
systemctl<span class="w"> </span>restart<span class="w"> </span>httpd
</code></pre></div>
</details>
<h3 id="step-62-install-certbot">Step 6.2 – Install Certbot<a class="headerlink" href="#step-62-install-certbot" title="Permanent link">&para;</a></h3>
<p>Install certbot using snapd (recommended method) or EPEL packages:</p>
<p><strong>Option A: Install via Snap (Recommended)</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install snapd</span>
dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>snapd
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>snapd.socket

<span class="c1"># Wait for snapd to initialize</span>
sleep<span class="w"> </span><span class="m">10</span>

<span class="c1"># Create symlink for classic snap support</span>
ln<span class="w"> </span>-sf<span class="w"> </span>/var/lib/snapd/snap<span class="w"> </span>/snap

<span class="c1"># Install certbot</span>
snap<span class="w"> </span>install<span class="w"> </span>--classic<span class="w"> </span>certbot

<span class="c1"># Create symlink for certbot command</span>
ln<span class="w"> </span>-sf<span class="w"> </span>/snap/bin/certbot<span class="w"> </span>/usr/bin/certbot
</code></pre></div>
<p><strong>Option B: Install via DNF (Alternative)</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install certbot from EPEL</span>
dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>certbot

<span class="c1"># Verify installation</span>
certbot<span class="w"> </span>--version
</code></pre></div>
<details class="info">
<summary>Why use snap for certbot?</summary>
<p>The Certbot developers recommend snap installation because:
- Always provides the latest certbot version
- Automatic updates via snap refresh
- Consistent across distributions
- Includes all necessary dependencies</p>
<p>EPEL packages work but may lag behind upstream releases.</p>
</details>
<h3 id="step-63-obtain-lets-encrypt-certificate">Step 6.3 – Obtain Let's Encrypt Certificate<a class="headerlink" href="#step-63-obtain-lets-encrypt-certificate" title="Permanent link">&para;</a></h3>
<p>Use certbot in standalone mode to obtain your certificate. Replace <code>&lt;your-fqdn&gt;</code> with your host's fully-qualified domain name
and <code>&lt;admin-email&gt;</code> with your email address (used for renewal notifications).</p>
<p><strong>Obtain certificate (interactive):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Stop Apache temporarily to free port 80</span>
systemctl<span class="w"> </span>stop<span class="w"> </span>httpd

<span class="c1"># Obtain certificate using standalone mode</span>
certbot<span class="w"> </span>certonly<span class="w"> </span>--standalone<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span>&lt;your-fqdn&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-m<span class="w"> </span>&lt;admin-email&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--agree-tos

<span class="c1"># Restart Apache</span>
systemctl<span class="w"> </span>start<span class="w"> </span>httpd
</code></pre></div>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code>certbot<span class="w"> </span>certonly<span class="w"> </span>--standalone<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span>ps-toolkit.example.org<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-m<span class="w"> </span>psadmin@example.org<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--agree-tos
</code></pre></div>
<p><strong>Non-interactive (for automation):</strong></p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>stop<span class="w"> </span>httpd

certbot<span class="w"> </span>certonly<span class="w"> </span>--standalone<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span>&lt;your-fqdn&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-m<span class="w"> </span>&lt;admin-email&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--agree-tos<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--non-interactive

systemctl<span class="w"> </span>start<span class="w"> </span>httpd
</code></pre></div>
<details class="info">
<summary>Certificate file locations</summary>
<p>After successful issuance, certificates are stored at:</p>
<ul>
<li>Full chain: <code>/etc/letsencrypt/live/&lt;your-fqdn&gt;/fullchain.pem</code></li>
<li>Private key: <code>/etc/letsencrypt/live/&lt;your-fqdn&gt;/privkey.pem</code></li>
<li>Chain only: <code>/etc/letsencrypt/live/&lt;your-fqdn&gt;/chain.pem</code></li>
<li>Certificate only: <code>/etc/letsencrypt/live/&lt;your-fqdn&gt;/cert.pem</code></li>
</ul>
<p>The actual certificate files are in <code>/etc/letsencrypt/archive/&lt;your-fqdn&gt;/</code> and the <code>live/</code> directory contains
symlinks to the latest versions.</p>
</details>
<h3 id="step-64-configure-apache-to-use-lets-encrypt-certificate">Step 6.4 – Configure Apache to Use Let's Encrypt Certificate<a class="headerlink" href="#step-64-configure-apache-to-use-lets-encrypt-certificate" title="Permanent link">&para;</a></h3>
<p>Use the helper script to update Apache SSL configuration:</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/configure-toolkit-letsencrypt.sh<span class="w"> </span>&lt;your-fqdn&gt;
</code></pre></div>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-toolkit/tools_scripts/configure-toolkit-letsencrypt.sh<span class="w"> </span>ps-toolkit.example.org
</code></pre></div>
<p>This script:</p>
<ul>
<li>Backs up the original Apache SSL configuration</li>
<li>Updates <code>SSLCertificateFile</code> to point to Let's Encrypt fullchain</li>
<li>Updates <code>SSLCertificateKeyFile</code> to point to Let's Encrypt private key</li>
<li>Adds or updates <code>SSLCertificateChainFile</code></li>
</ul>
<p><strong>Verify Apache configuration syntax:</strong></p>
<div class="highlight"><pre><span></span><code>apachectl<span class="w"> </span>configtest
</code></pre></div>
<p><strong>Reload Apache to apply changes:</strong></p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>reload<span class="w"> </span>httpd
</code></pre></div>
<p><strong>Verify the certificate is in use:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check certificate via OpenSSL</span>
<span class="nb">echo</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>&lt;your-fqdn&gt;:443<span class="w"> </span>-servername<span class="w"> </span>&lt;your-fqdn&gt;<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-issuer<span class="w"> </span>-dates

<span class="c1"># Should show:</span>
<span class="c1"># issuer=C=US, O=Let&#39;s Encrypt, CN=...</span>
<span class="c1"># notBefore=...</span>
<span class="c1"># notAfter=...</span>
</code></pre></div>
<p><strong>Test in browser:</strong></p>
<p>Navigate to <code>https://&lt;your-fqdn&gt;/toolkit</code> and verify:</p>
<ul>
<li>No certificate warnings</li>
<li>Certificate is issued by "Let's Encrypt"</li>
<li>Certificate is valid (green padlock icon)</li>
</ul>
<h3 id="step-65-configure-automatic-certificate-renewal">Step 6.5 – Configure Automatic Certificate Renewal<a class="headerlink" href="#step-65-configure-automatic-certificate-renewal" title="Permanent link">&para;</a></h3>
<p>Let's Encrypt certificates expire after 90 days. Configure automatic renewal to avoid expiration.</p>
<p><strong>Test renewal process (dry run):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Perform a test renewal without actually renewing</span>
certbot<span class="w"> </span>renew<span class="w"> </span>--dry-run<span class="w"> </span>--pre-hook<span class="w"> </span><span class="s2">&quot;systemctl stop httpd&quot;</span><span class="w"> </span>--post-hook<span class="w"> </span><span class="s2">&quot;systemctl start httpd&quot;</span>
</code></pre></div>
<p>If the dry run succeeds, configure automatic renewal:</p>
<p><strong>Option A: Using Certbot Timer (Recommended)</strong></p>
<p>Certbot automatically installs a systemd timer for renewals when installed via snap:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check timer status</span>
systemctl<span class="w"> </span>list-timers<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>certbot

<span class="c1"># If not present, enable it</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>snap.certbot.renew.timer

<span class="c1"># Or for EPEL installation:</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>certbot-renew.timer
</code></pre></div>
<p><strong>Option B: Using Cron (Alternative)</strong></p>
<p>Add a cron job for automatic renewal:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create renewal script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/certbot-renew.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>
<span class="s"># Renew Let&#39;s Encrypt certificates and reload Apache</span>

<span class="s">certbot renew \</span>
<span class="s">    --pre-hook &quot;systemctl stop httpd&quot; \</span>
<span class="s">    --post-hook &quot;systemctl start httpd&quot; \</span>
<span class="s">    --quiet</span>

<span class="s">exit 0</span>
<span class="s">EOF</span>

chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>/usr/local/bin/certbot-renew.sh

<span class="c1"># Add cron job (runs twice daily at 3:30 AM and 3:30 PM)</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/etc/cron.d/certbot-renew<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">30 3,15 * * * root /usr/local/bin/certbot-renew.sh</span>
<span class="s">EOF</span>
</code></pre></div>
<details class="info">
<summary>Renewal frequency and timing</summary>
<ul>
<li>Certbot automatically checks certificates and only renews those expiring within 30 days</li>
<li>Running renewal checks twice daily ensures timely renewal even if one attempt fails</li>
<li>The <code>--quiet</code> flag suppresses output unless there's an error</li>
<li>Pre/post hooks stop and start Apache to free port 80 for the standalone authenticator</li>
</ul>
</details>
<p><strong>Verify automatic renewal is configured:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># For snap installation</span>
systemctl<span class="w"> </span>status<span class="w"> </span>snap.certbot.renew.timer

<span class="c1"># For EPEL installation</span>
systemctl<span class="w"> </span>status<span class="w"> </span>certbot-renew.timer

<span class="c1"># For cron-based renewal</span>
crontab<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>certbot
<span class="c1"># or</span>
cat<span class="w"> </span>/etc/cron.d/certbot-renew
</code></pre></div>
<h3 id="step-66-monitor-certificate-expiration">Step 6.6 – Monitor Certificate Expiration<a class="headerlink" href="#step-66-monitor-certificate-expiration" title="Permanent link">&para;</a></h3>
<p>Even with automatic renewal, monitor certificate expiration to catch renewal failures:</p>
<p><strong>Check certificate expiration date:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check all certificates</span>
certbot<span class="w"> </span>certificates

<span class="c1"># Check specific certificate via OpenSSL</span>
<span class="nb">echo</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>&lt;your-fqdn&gt;:443<span class="w"> </span>-servername<span class="w"> </span>&lt;your-fqdn&gt;<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-dates
</code></pre></div>
<p><strong>Set up expiration monitoring (optional):</strong></p>
<details class="tip">
<summary>Email alerts for expiration</summary>
<p>Let's Encrypt sends expiration warning emails to the address provided during certificate issuance. Ensure this email
address is monitored:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check configured email</span>
grep<span class="w"> </span>email<span class="w"> </span>/etc/letsencrypt/renewal/&lt;your-fqdn&gt;.conf
</code></pre></div>
<p>You can also set up local monitoring using nagios, icinga, or a simple script:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># check-cert-expiry.sh - Alert if certificate expires within 14 days</span>

<span class="nv">DOMAIN</span><span class="o">=</span><span class="s2">&quot;&lt;your-fqdn&gt;&quot;</span>
<span class="nv">WARN_DAYS</span><span class="o">=</span><span class="m">14</span>

<span class="nv">EXPIRY</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span><span class="si">${</span><span class="nv">DOMAIN</span><span class="si">}</span>:443<span class="w"> </span>-servername<span class="w"> </span><span class="si">${</span><span class="nv">DOMAIN</span><span class="si">}</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">         </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-enddate<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="o">=</span><span class="w"> </span>-f2<span class="k">)</span>

<span class="nv">EXPIRY_EPOCH</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">EXPIRY</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>+%s<span class="k">)</span>
<span class="nv">NOW_EPOCH</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<span class="nv">DAYS_LEFT</span><span class="o">=</span><span class="k">$((</span><span class="w"> </span><span class="o">(</span><span class="nv">EXPIRY_EPOCH</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">NOW_EPOCH</span><span class="o">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">86400</span><span class="w"> </span><span class="k">))</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$DAYS_LEFT</span><span class="w"> </span>-lt<span class="w"> </span><span class="nv">$WARN_DAYS</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;WARNING: Certificate for </span><span class="si">${</span><span class="nv">DOMAIN</span><span class="si">}</span><span class="s2"> expires in </span><span class="si">${</span><span class="nv">DAYS_LEFT</span><span class="si">}</span><span class="s2"> days!&quot;</span>
<span class="w">    </span><span class="c1"># Send alert via email, Slack, etc.</span>
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;OK: Certificate valid for </span><span class="si">${</span><span class="nv">DAYS_LEFT</span><span class="si">}</span><span class="s2"> more days&quot;</span>
<span class="k">fi</span>
</code></pre></div>
</details>
<h3 id="troubleshooting-lets-encrypt">Troubleshooting Let's Encrypt<a class="headerlink" href="#troubleshooting-lets-encrypt" title="Permanent link">&para;</a></h3>
<details class="failure">
<summary>Certificate issuance fails with 'Connection refused'</summary>
<p><strong>Symptoms:</strong> Certbot fails with "Failed to authenticate" or "Connection refused" errors during HTTP-01 challenge.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Verify port 80 is open in firewall</span>
nft<span class="w"> </span>list<span class="w"> </span>ruleset<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;dport 80&quot;</span>

<span class="c1"># Test port 80 accessibility from external host</span>
curl<span class="w"> </span>-v<span class="w"> </span>http://&lt;your-fqdn&gt;/

<span class="c1"># Check nothing is listening on port 80</span>
ss<span class="w"> </span>-tlnp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:80
</code></pre></div>
<p><strong>Solutions:</strong></p>
<ul>
<li>Add port 80 to nftables: <code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-install-nftables.sh --ports=80,443 --yes</code></li>
<li>Ensure Apache is not listening on port 80 (should only listen on 443)</li>
<li>Verify DNS resolves correctly from public internet</li>
<li>Check network firewall/router allows inbound port 80</li>
</ul>
</details>
<details class="failure">
<summary>Certificate renewal fails</summary>
<p><strong>Symptoms:</strong> Certificate expires or renewal fails with errors in logs.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check renewal logs</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>snap.certbot.renew.timer<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span>
<span class="c1"># or</span>
grep<span class="w"> </span>certbot<span class="w"> </span>/var/log/syslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-50

<span class="c1"># Test renewal manually</span>
certbot<span class="w"> </span>renew<span class="w"> </span>--dry-run<span class="w"> </span>--pre-hook<span class="w"> </span><span class="s2">&quot;systemctl stop httpd&quot;</span><span class="w"> </span>--post-hook<span class="w"> </span><span class="s2">&quot;systemctl start httpd&quot;</span><span class="w"> </span>-vvv

<span class="c1"># Check certificate status</span>
certbot<span class="w"> </span>certificates
</code></pre></div>
<p><strong>Common causes:</strong></p>
<ul>
<li>Port 80 blocked: Verify firewall allows HTTP during renewal</li>
<li>Apache failed to stop/start: Check Apache service status</li>
<li>DNS changes: Verify hostname still resolves correctly</li>
<li>Rate limiting: Let's Encrypt has rate limits (5 renewals per 7 days per domain)</li>
</ul>
<p><strong>Solutions:</strong></p>
<ul>
<li>Fix firewall or DNS issues</li>
<li>Manually renew: <code>certbot renew --force-renewal</code></li>
<li>If rate limited, wait 7 days before retrying</li>
</ul>
</details>
<details class="failure">
<summary>Browser shows old certificate after renewal</summary>
<p><strong>Symptoms:</strong> Certificate renewed successfully but browser still shows old/expired certificate.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check certificate files are updated</span>
ls<span class="w"> </span>-la<span class="w"> </span>/etc/letsencrypt/live/&lt;your-fqdn&gt;/

<span class="c1"># Verify Apache configuration points to correct files</span>
grep<span class="w"> </span>SSLCertificate<span class="w"> </span>/etc/httpd/conf.d/ssl.conf

<span class="c1"># Check Apache loaded the new certificate</span>
systemctl<span class="w"> </span>status<span class="w"> </span>httpd
</code></pre></div>
<p><strong>Solutions:</strong></p>
<ul>
<li>Reload or restart Apache: <code>systemctl restart httpd</code></li>
<li>Clear browser cache and hard refresh (Ctrl+Shift+R)</li>
<li>Verify SSL configuration: <code>apachectl -t -D DUMP_VHOSTS</code></li>
</ul>
</details>
<hr />
<h2 id="step-7-configure-and-enroll-in-psconfig">Step 7 – Configure and Enroll in pSConfig<a class="headerlink" href="#step-7-configure-and-enroll-in-psconfig" title="Permanent link">&para;</a></h2>
<p>Enroll your toolkit host with the OSG/WLCG pSConfig service so tests are auto-configured. Use the "auto URL" for each FQDN
you expose for perfSONAR (one or two depending on whether you split latency/throughput by hostname).</p>
<h3 id="option-a-web-ui-configuration-recommended">Option A: Web UI Configuration (Recommended)<a class="headerlink" href="#option-a-web-ui-configuration-recommended" title="Permanent link">&para;</a></h3>
<p>The easiest way to configure pSConfig is via the web interface:</p>
<ol>
<li>Navigate to: <code>https://&lt;your-hostname&gt;/toolkit/admin?view=psconfig</code></li>
<li>Click "Add Remote Configuration"</li>
<li>Enter the auto URL: <code>https://psconfig.opensciencegrid.org/pub/auto/&lt;your-fqdn&gt;</code></li>
<li>Enable "Configure Archives" to automatically set up result archiving</li>
<li>Save and restart the pSConfig agent</li>
</ol>
<h3 id="option-b-command-line-configuration">Option B: Command Line Configuration<a class="headerlink" href="#option-b-command-line-configuration" title="Permanent link">&para;</a></h3>
<p>Basic enrollment via command line:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Add auto URLs (configures archives too) and show configured remotes</span>
psconfig<span class="w"> </span>remote<span class="w"> </span>--configure-archives<span class="w"> </span>add<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;https://psconfig.opensciencegrid.org/pub/auto/ps-lat-example.my.edu&quot;</span>

psconfig<span class="w"> </span>remote<span class="w"> </span>list
</code></pre></div>
<p>If there are any stale/old/incorrect entries, you can remove them:</p>
<div class="highlight"><pre><span></span><code>psconfig<span class="w"> </span>remote<span class="w"> </span>delete<span class="w"> </span><span class="s2">&quot;&lt;old-url&gt;&quot;</span>
</code></pre></div>
<h3 id="option-c-automated-enrollment-script">Option C: Automated Enrollment Script<a class="headerlink" href="#option-c-automated-enrollment-script" title="Permanent link">&para;</a></h3>
<p>Automation tip: derive FQDNs from your configured IPs (PTR lookup) and enroll automatically. Review the list before applying.</p>
<p><strong>For RPM Toolkit installs (non-container):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Dry run only (show planned URLs):</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>--local<span class="w"> </span>-n

<span class="c1"># Apply enrollment:</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>--local<span class="w"> </span>-v

<span class="c1"># Verify configured remotes</span>
psconfig<span class="w"> </span>remote<span class="w"> </span>list
</code></pre></div>
<p><strong>For container-based installs:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Dry run only (show planned URLs):</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>-n

<span class="c1"># Apply enrollment:</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>-v

<span class="c1"># Verify configured remotes</span>
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>psconfig<span class="w"> </span>remote<span class="w"> </span>list
</code></pre></div>
<details class="note">
<summary>The auto enroll psconfig script details</summary>
<ul>
<li>Parses IP lists from <code>/etc/perfSONAR-multi-nic-config.conf</code>  (<code>NIC_IPV4_ADDRS</code> / <code>NIC_IPV6_ADDRS</code>).</li>
<li>Performs reverse DNS lookups (getent/dig) to derive FQDNs.</li>
<li>Deduplicates while preserving discovery order.</li>
<li>Adds each <code>https://psconfig.opensciencegrid.org/pub/auto/&lt;FQDN&gt;</code> with <code>--configure-archives</code>.</li>
<li>Lists configured remotes and returns non-zero if any enrollment fails.</li>
</ul>
<p>Integrate into provisioning CI by running with <code>-n</code> (dry-run) for approval and then <code>-y</code> once approved.</p>
</details>
<hr />
<h2 id="step-8-register-and-configure-with-wlcgosg">Step 8 – Register and Configure with WLCG/OSG<a class="headerlink" href="#step-8-register-and-configure-with-wlcgosg" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>OSG/WLCG registration workflow:</strong></p>
<details class="info">
<summary>Registration steps and portals</summary>
<ul>
<li>Register the host in <a href="https://topology.opensciencegrid.org/host">OSG topology</a>.</li>
<li>Create or update a <a href="https://ggus.eu/">GGUS</a> ticket announcing the new measurement point.</li>
<li>In <a href="https://goc.egi.eu/portal/">GOCDB</a>, add the service endpoint
        <code>org.opensciencegrid.crc.perfsonar-testpoint</code> bound to this host.</li>
</ul>
</details>
</li>
<li>
<p><strong>Document memberships:</strong></p>
<p>Update your site wiki or change log with assigned mesh names, feed  URLs, and support contacts.</p>
</li>
<li>
<p><strong>Update Lookup Service registration:</strong></p>
<p><strong>Option A: Web UI (Recommended)</strong></p>
<p>The easiest way to configure registration information is via the Toolkit web interface:</p>
<ol>
<li>Navigate to: <code>https://&lt;your-hostname&gt;/toolkit/admin?view=host</code></li>
<li>Fill in administrative information:<ul>
<li>Site name, organization, location (city, state, country, zip code)</li>
<li>Latitude and longitude (for map display)</li>
<li>Administrator name and email</li>
<li>Projects (WLCG, OSG, etc.)</li>
</ul>
</li>
<li>Save changes - the lsregistrationdaemon restarts automatically</li>
</ol>
<p><strong>Option B: Command Line</strong></p>
<p>Edit <code>/etc/perfsonar/lsregistrationdaemon.conf</code> directly and restart the service:</p>
<div class="highlight"><pre><span></span><code>vi<span class="w"> </span>/etc/perfsonar/lsregistrationdaemon.conf

<span class="c1"># After editing, restart the registration daemon</span>
systemctl<span class="w"> </span>restart<span class="w"> </span>perfsonar-lsregistrationdaemon
</code></pre></div>
<p><strong>Option C: Helper Script</strong></p>
<p>Use the helper script to update registration. For RPM Toolkit installs, use the <code>--local</code> flag:</p>
<p><strong>For RPM Toolkit installs (non-container):</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Preview changes only</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span>update<span class="w"> </span>--local<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dry-run<span class="w"> </span>--site-name<span class="w"> </span><span class="s2">&quot;Acme Co.&quot;</span><span class="w"> </span>--project<span class="w"> </span>WLCG<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--admin-email<span class="w"> </span>admin@example.org<span class="w"> </span>--admin-name<span class="w"> </span><span class="s2">&quot;pS Admin&quot;</span>

<span class="c1"># Apply new settings and restart the daemon</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span>create<span class="w"> </span>--local<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--site-name<span class="w"> </span><span class="s2">&quot;Acme Co.&quot;</span><span class="w"> </span>--domain<span class="w"> </span>example.org<span class="w"> </span>--project<span class="w"> </span>WLCG<span class="w"> </span>--project<span class="w"> </span>OSG<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--city<span class="w"> </span>Berkeley<span class="w"> </span>--region<span class="w"> </span>CA<span class="w"> </span>--country<span class="w"> </span>US<span class="w"> </span>--zip<span class="w"> </span><span class="m">94720</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--latitude<span class="w"> </span><span class="m">37</span>.5<span class="w"> </span>--longitude<span class="w"> </span>-121.7469<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--admin-name<span class="w"> </span><span class="s2">&quot;pS Admin&quot;</span><span class="w"> </span>--admin-email<span class="w"> </span>admin@example.org

<span class="c1"># Save current config (raw conf file)</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span>save<span class="w"> </span>--output<span class="w"> </span>my-lsreg.conf<span class="w"> </span>--local

<span class="c1"># Or produce a self-contained executable restore script</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span>extract<span class="w"> </span>--output<span class="w"> </span>/root/restore-lsreg.sh<span class="w"> </span>--local
</code></pre></div></p>
</li>
<li>
<p><strong>Automatic updates</strong></p>
<p>The perfSONAR Toolkit uses <code>dnf-automatic</code> for automatic updates (already configured in Step 5).</p>
</li>
</ol>
<hr />
<h2 id="step-9-selinux-troubleshooting-if-enabled">Step 9 – SELinux Troubleshooting (If Enabled)<a class="headerlink" href="#step-9-selinux-troubleshooting-if-enabled" title="Permanent link">&para;</a></h2>
<p>If you've enabled SELinux in enforcing mode, certain perfSONAR operations may generate audit log alerts. This section explains common issues and their fixes.</p>
<h3 id="selinux-basics-for-perfsonar">SELinux Basics for perfSONAR<a class="headerlink" href="#selinux-basics-for-perfsonar" title="Permanent link">&para;</a></h3>
<p>SELinux enforces mandatory access controls based on file labels and process contexts. perfSONAR services run under specific contexts (e.g., <code>lsregistrationdaemon_t</code>, <code>httpd_t</code>), and accessed files must have compatible labels.</p>
<p><strong>Check SELinux status:</strong></p>
<div class="highlight"><pre><span></span><code>sestatus
<span class="c1"># Expected output: &quot;SELinux status:  enabled&quot; and &quot;Current mode:  enforcing&quot;</span>
</code></pre></div>
<h3 id="common-selinux-issues-and-fixes">Common SELinux Issues and Fixes<a class="headerlink" href="#common-selinux-issues-and-fixes" title="Permanent link">&para;</a></h3>
<h4 id="issue-1-etcperfsonarlsregistrationdaemonconf-has-wrong-label">Issue 1: <code>/etc/perfsonar/lsregistrationdaemon.conf</code> Has Wrong Label<a class="headerlink" href="#issue-1-etcperfsonarlsregistrationdaemonconf-has-wrong-label" title="Permanent link">&para;</a></h4>
<p><strong>Symptom:</strong> Audit log shows:
<div class="highlight"><pre><span></span><code>SELinux is preventing /usr/bin/perl from getattr access on the file /etc/perfsonar/lsregistrationdaemon.conf.
</code></pre></div></p>
<p><strong>Root cause:</strong> The configuration file was created or modified (e.g., via restore or manual edit) and has an incorrect SELinux label. The file should be labeled <code>lsregistrationdaemon_etc_t</code> but may be labeled <code>admin_home_t</code> or have no label.</p>
<p><strong>Fix: Apply <code>restorecon</code> to relabel the file:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Restore the default SELinux context for the file</span>
sudo<span class="w"> </span>/sbin/restorecon<span class="w"> </span>-v<span class="w"> </span>/etc/perfsonar/lsregistrationdaemon.conf

<span class="c1"># Verify the label is now correct</span>
ls<span class="w"> </span>-Z<span class="w"> </span>/etc/perfsonar/lsregistrationdaemon.conf
<span class="c1"># Expected: system_u:object_r:lsregistrationdaemon_etc_t:s0</span>
</code></pre></div>
<p><strong>Automatic fix during restore:</strong></p>
<p>Our <code>perfSONAR-update-lsregistration.sh</code> helper attempts to automatically apply <code>restorecon</code> after writing the configuration file. If <code>restorecon</code> is available on your system, it runs without user intervention:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Use the helper to restore config (with automatic restorecon attempt)</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span>restore<span class="w"> </span>--local<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--input<span class="w"> </span>./my-lsreg.conf

<span class="c1"># Or extract and run a self-contained restore script</span>
/opt/perfsonar-toolkit/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span>extract<span class="w"> </span>--local<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>./restore-lsreg.sh
./restore-lsreg.sh<span class="w">  </span><span class="c1"># This script includes a restorecon attempt</span>
</code></pre></div>
<p><strong>Preventing the issue:</strong></p>
<ul>
<li>Always use the helper script (<code>perfSONAR-update-lsregistration.sh</code>) for configuration changes, as it handles <code>restorecon</code> automatically.</li>
<li>After any manual edits to <code>/etc/perfsonar/lsregistrationdaemon.conf</code>, explicitly run <code>restorecon</code>:
  <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/perfsonar/lsregistrationdaemon.conf
sudo<span class="w"> </span>/sbin/restorecon<span class="w"> </span>-v<span class="w"> </span>/etc/perfsonar/lsregistrationdaemon.conf<span class="w">  </span><span class="c1"># Fix labels immediately</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>perfsonar-lsregistrationdaemon
</code></pre></div></li>
</ul>
<h4 id="issue-2-other-services-ethtool-df-python3-postgresql-collect2-generating-audit-alerts">Issue 2: Other Services (ethtool, df, python3, postgresql, collect2) Generating Audit Alerts<a class="headerlink" href="#issue-2-other-services-ethtool-df-python3-postgresql-collect2-generating-audit-alerts" title="Permanent link">&para;</a></h4>
<p><strong>Symptoms:</strong> Audit log shows alerts for various tools running in unexpected SELinux contexts:
<div class="highlight"><pre><span></span><code>SELinux is preventing /usr/sbin/ethtool from setopt access on netlink_generic_socket labeled httpd_t.
SELinux is preventing /usr/bin/df from getattr access on the directory /var/cache/openafs.
SELinux is preventing /usr/bin/python3.9 from execute access on the file ldconfig.
SELinux is preventing /usr/libexec/gcc/x86_64-redhat-linux/11/collect2 from search access on the directory snapd.
</code></pre></div></p>
<p><strong>Root cause:</strong> These alerts typically stem from:
- Tools invoked from web interfaces or services running in different SELinux contexts (e.g., <code>httpd_t</code>, <code>postgresql_t</code>)
- Third-party or system utilities that lack complete SELinux policy coverage
- Legitimate operations conflicting with default policy rules
- Build/compilation tools invoked during package installation (usually transient)</p>
<p><strong>Assessment and diagnosis:</strong></p>
<ol>
<li><strong>Check if the alert is related to perfSONAR functionality:</strong></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># View recent audit alerts</span>
tail<span class="w"> </span>-100<span class="w"> </span>/var/log/audit/audit.log

<span class="c1"># Filter by command name to see context</span>
grep<span class="w"> </span><span class="s2">&quot;ethtool\|df\|python\|collect2\|ldconfig&quot;</span><span class="w"> </span>/var/log/audit/audit.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20

<span class="c1"># Count alert types to identify patterns</span>
ausearch<span class="w"> </span>-m<span class="w"> </span>AVC<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;avc:&#39;</span><span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10
</code></pre></div>
<ol>
<li>
<p><strong>Determine the source process and context:</strong></p>
</li>
<li>
<p>Alerts mentioning <code>httpd_t</code> usually indicate the web UI triggered the operation (typically safe to allow)</p>
</li>
<li>Alerts from <code>postgresql_t</code> indicate database tools being invoked (context boundary may not be required)</li>
<li>Alerts from <code>lsregistrationdaemon_t</code> indicate the registration daemon needs access (fix labels first, not policies)</li>
<li>
<p>Alerts from <code>gcc/collect2</code> during package install are usually transient (monitor periodically)</p>
</li>
<li>
<p><strong>Create a local SELinux policy module</strong> (if operation is verified as safe)</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># Generate policy module for a specific alert (example: ethtool)</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;ethtool&#39;</span><span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2allow<span class="w"> </span>-M<span class="w"> </span>my-ethtool

<span class="c1"># Review the generated module to ensure it&#39;s safe</span>
cat<span class="w"> </span>my-ethtool.te

<span class="c1"># Install the module (if approved and safe)</span>
sudo<span class="w"> </span>semodule<span class="w"> </span>-i<span class="w"> </span>my-ethtool.pp

<span class="c1"># Verify installation</span>
semodule<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>my-ethtool
</code></pre></div>
<p><strong>Specific service fixes:</strong></p>
<p><strong>ethtool netlink access (from httpd_t or lsregistrationdaemon_t):</strong>
   - <strong>Operation:</strong> Checking NIC link status, speed, duplex (safe)
   - <strong>Source:</strong> Web UI health checks or daemon monitoring
   - <strong>Fix:</strong>
     <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>ausearch<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;ethtool&#39;</span><span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2allow<span class="w"> </span>-M<span class="w"> </span>my-ethtool
sudo<span class="w"> </span>semodule<span class="w"> </span>-i<span class="w"> </span>my-ethtool.pp
</code></pre></div></p>
<p><strong>df/stat on /var/cache/openafs (from lsregistrationdaemon_t):</strong>
   - <strong>Operation:</strong> Checking available disk space (safe)
   - <strong>Source:</strong> Registration daemon system health queries
   - <strong>Fix:</strong>
     <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>ausearch<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;df&#39;</span><span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2allow<span class="w"> </span>-M<span class="w"> </span>my-df
sudo<span class="w"> </span>semodule<span class="w"> </span>-i<span class="w"> </span>my-df.pp
</code></pre></div></p>
<p><strong>python3/postgresql context issues (collect2, ldconfig):</strong>
   - <strong>Operation:</strong> Build tools, library checks during package installation (usually transient)
   - <strong>Assessment:</strong> These are typically safe but may be ephemeral
   - <strong>Fix (if persistent):</strong>
     <div class="highlight"><pre><span></span><code><span class="c1"># For postgresql-related alerts</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;validate-config&#39;</span><span class="w"> </span>--raw<span class="w"> </span><span class="p">|</span><span class="w"> </span>audit2allow<span class="w"> </span>-M<span class="w"> </span>my-postgresql
sudo<span class="w"> </span>semodule<span class="w"> </span>-i<span class="w"> </span>my-postgresql.pp
</code></pre></div></p>
<p><strong>Audit log monitoring (prevents future surprises):</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check for recent AVC denials</span>
sudo<span class="w"> </span>ausearch<span class="w"> </span>-m<span class="w"> </span>AVC<span class="w"> </span>-ts<span class="w"> </span>recent<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-50

<span class="c1"># Create a daily monitoring script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/check-selinux-alerts.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>
<span class="s"># Check for recent SELinux audit alerts</span>

<span class="s">RECENT_ALERTS=$(ausearch -m AVC -ts recent 2&gt;/dev/null | wc -l)</span>

<span class="s">if [ $RECENT_ALERTS -gt 0 ]; then</span>
<span class="s">    echo &quot;WARNING: Found $RECENT_ALERTS recent SELinux alerts:&quot;</span>
<span class="s">    ausearch -m AVC -ts recent | tail -20</span>
<span class="s">else</span>
<span class="s">    echo &quot;OK: No recent SELinux audit alerts&quot;</span>
<span class="s">fi</span>
<span class="s">EOF</span>

chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>/usr/local/bin/check-selinux-alerts.sh

<span class="c1"># Add to cron (runs daily at 9 AM)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 9 * * * root /usr/local/bin/check-selinux-alerts.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/cron.d/selinux-alert-check
</code></pre></div>
<p><strong>Best practice for handling alerts:</strong></p>
<ol>
<li>Log all alerts for 1-2 weeks to establish a baseline</li>
<li>Review and categorize (safe vs. unsafe operations)</li>
<li>Create local policy modules only for verified, safe operations</li>
<li>Document each module in your change log</li>
<li>Monitor weekly for new or unexpected alerts</li>
</ol>
<h4 id="issue-3-audit-log-flooding">Issue 3: Audit Log Flooding<a class="headerlink" href="#issue-3-audit-log-flooding" title="Permanent link">&para;</a></h4>
<p><strong>Symptom:</strong> Audit log grows very large due to repeated identical alerts.</p>
<p><strong>Mitigation:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># View count of each AVC alert type</span>
ausearch<span class="w"> </span>-m<span class="w"> </span>AVC<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;avc:&#39;</span><span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20

<span class="c1"># Suppress specific alerts (if they are verified as safe):</span>
<span class="c1"># Add rules to /etc/audit/audit.rules or /etc/audit/rules.d/</span>
<span class="c1"># (requires audit service restart and SELinux expertise)</span>
</code></pre></div>
<h3 id="best-practices-for-selinux-with-perfsonar">Best Practices for SELinux with perfSONAR<a class="headerlink" href="#best-practices-for-selinux-with-perfsonar" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Use automated tools:</strong> Always use the helper scripts (<code>perfSONAR-update-lsregistration.sh</code>, <code>perfSONAR-install-nftables.sh</code>) which handle SELinux contexts automatically.</p>
</li>
<li>
<p><strong>Run <code>restorecon</code> after manual edits:</strong> If you manually edit any perfSONAR configuration file, immediately restore the SELinux context:
   <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>/sbin/restorecon<span class="w"> </span>-v<span class="w"> </span>/path/to/file
</code></pre></div></p>
</li>
<li>
<p><strong>Monitor audit logs regularly:</strong> Check <code>/var/log/audit/audit.log</code> weekly to catch new issues early.</p>
</li>
<li>
<p><strong>Document exceptions:</strong> If you create local SELinux policy modules, document them in your change log so future admins understand why they exist.</p>
</li>
<li>
<p><strong>Keep policies minimal:</strong> Only add local policy modules for operations that are verified as safe and necessary. Overly permissive policies increase security risk.</p>
</li>
</ol>
<hr />
<h2 id="step-10-post-install-validation">Step 10 – Post-Install Validation<a class="headerlink" href="#step-10-post-install-validation" title="Permanent link">&para;</a></h2>
<p>Perform these checks before handing the host over to operations:</p>
<ol>
<li>
<p><strong>System services:</strong></p>
<details class="info">
<summary>Verify perfSONAR services</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Check all perfSONAR services are running</span>
systemctl<span class="w"> </span>status<span class="w"> </span>pscheduler-scheduler<span class="w"> </span>pscheduler-runner<span class="w"> </span>pscheduler-archiver<span class="w"> </span>pscheduler-ticker
systemctl<span class="w"> </span>status<span class="w"> </span>psconfig-pscheduler-agent<span class="w"> </span>owamp-server<span class="w"> </span>perfsonar-lsregistrationdaemon

<span class="c1"># Check web server (Apache)</span>
systemctl<span class="w"> </span>status<span class="w"> </span>apache2<span class="w"> </span>--no-pager

<span class="c1"># Check measurement archive services</span>
systemctl<span class="w"> </span>status<span class="w"> </span>opensearch<span class="w"> </span>logstash
</code></pre></div>
</details>
<p>Ensure all services show <code>active (running)</code> status.</p>
</li>
<li>
<p><strong>Web interface access:</strong></p>
<details class="info">
<summary>Verify web UI is accessible</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Test HTTPS connectivity to web UI</span>
curl<span class="w"> </span>-k<span class="w"> </span>-s<span class="w"> </span>-o<span class="w"> </span>/dev/null<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;%{http_code}&quot;</span><span class="w"> </span>https://localhost/toolkit
<span class="c1"># Should return 200</span>

<span class="c1"># Check Apache error logs if issues</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>apache2<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span>
</code></pre></div>
<p>Access the web UI in a browser: <code>https://&lt;your-hostname&gt;/toolkit</code></p>
<p>Verify the dashboard loads and shows measurement results (may take a few minutes after first tests run).</p>
</details>
</li>
<li>
<p><strong>Service logs:</strong></p>
<details class="info">
<summary>Check perfSONAR service logs for errors</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Check pScheduler logs for errors</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>pscheduler-scheduler<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span><span class="w"> </span>--no-pager
journalctl<span class="w"> </span>-u<span class="w"> </span>pscheduler-runner<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span><span class="w"> </span>--no-pager

<span class="c1"># Check pSConfig agent logs</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>psconfig-pscheduler-agent<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span><span class="w"> </span>--no-pager

<span class="c1"># Check registration daemon</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>perfsonar-lsregistrationdaemon<span class="w"> </span>-n<span class="w"> </span><span class="m">20</span><span class="w"> </span>--no-pager
</code></pre></div>
</details>
</li>
<li>
<p><strong>Network path validation:</strong></p>
<details class="info">
<summary>Test network connectivity and routing</summary>
<p>Test throughput to a remote endpoint:
<div class="highlight"><pre><span></span><code>pscheduler<span class="w"> </span>task<span class="w"> </span>throughput<span class="w"> </span>--dest<span class="w"> </span>&lt;remote-testpoint&gt;
</code></pre></div></p>
<p>Check routing from the host:
<div class="highlight"><pre><span></span><code>tracepath<span class="w"> </span>-n<span class="w"> </span>&lt;remote-testpoint&gt;
ip<span class="w"> </span>route<span class="w"> </span>get<span class="w"> </span>&lt;remote-testpoint-ip&gt;
</code></pre></div></p>
<p>Confirm traffic uses the intended policy-based routes (check <code>ip route get &lt;dest&gt;</code>).</p>
</details>
</li>
<li>
<p><strong>Security posture:</strong></p>
<details class="info">
<summary>Check firewall, fail2ban, and SELinux</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Check nftables firewall rules</span>
nft<span class="w"> </span>list<span class="w"> </span>ruleset<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>perfsonar

<span class="c1"># Check fail2ban status (automatically installed by toolkit)</span>
systemctl<span class="w"> </span>status<span class="w"> </span>fail2ban
fail2ban-client<span class="w"> </span>status

<span class="c1"># Check for recent SELinux denials</span>
<span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>ausearch<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>ausearch<span class="w"> </span>--message<span class="w"> </span>AVC<span class="w"> </span>--just-one
<span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>/var/log/audit/audit.log<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;avc.*denied&quot;</span><span class="w"> </span>/var/log/audit/audit.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-5
<span class="k">else</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SELinux audit tools not available&quot;</span>
<span class="k">fi</span>
</code></pre></div>
</details>
<p>Investigate any SELinux denials or repeated Fail2Ban bans.</p>
</li>
<li>
<p><strong>Certificate check (if using HTTPS):</strong></p>
<details class="info">
<summary>Verify certificate validity</summary>
<div class="highlight"><pre><span></span><code><span class="c1"># Check certificate via HTTPS connection</span>
<span class="nb">echo</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>&lt;your-hostname&gt;:443<span class="w"> </span>-servername<span class="w"> </span>&lt;your-hostname&gt;<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-dates<span class="w"> </span>-issuer
</code></pre></div>
</details>
<p>Ensure the certificate is valid and not expired.</p>
</li>
<li>
<p><strong>Measurement archive:</strong></p>
<details class="info">
<summary>Verify local archive is collecting data</summary>
<p>Check that OpenSearch is receiving measurement results:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check OpenSearch cluster health</span>
curl<span class="w"> </span>-k<span class="w"> </span>https://localhost:9200/_cluster/health?pretty

<span class="c1"># Check for measurement data (after tests have run)</span>
curl<span class="w"> </span>-k<span class="w"> </span>https://localhost:9200/_cat/indices?v<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pscheduler
</code></pre></div>
<p>Via web UI: Navigate to <code>https://&lt;your-hostname&gt;/toolkit/archive</code> to view stored measurements.</p>
</details>
</li>
<li>
<p><strong>Reporting:</strong></p>
<details class="info">
<summary>Run perfSONAR diagnostic reports</summary>
<p>Run the perfSONAR troubleshoot command and send outputs to operations:
<div class="highlight"><pre><span></span><code>pscheduler<span class="w"> </span>troubleshoot
</code></pre></div></p>
</details>
</li>
</ol>
<hr />
<h2 id="ongoing-maintenance">Ongoing Maintenance<a class="headerlink" href="#ongoing-maintenance" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Quarterly or as-needed:</strong> Re-validate routing policy and nftables rules after network changes or security audits.</p>
</li>
<li>
<p><strong>Monthly or during maintenance windows:</strong> Apply OS updates (<code>dnf update</code>) and reboot during scheduled downtime.</p>
</li>
<li>
<p>Monitor psconfig feeds for changes in mesh participation and test configuration.</p>
</li>
<li>
<p>Track certificate expiry with <code>certbot renew --dry-run</code> if you rely on Let's Encrypt (automatic renewal is configured but monitoring is recommended).</p>
</li>
<li>
<p>Review container logs periodically for errors: <code>podman logs perfsonar-testpoint</code> and <code>podman logs certbot</code>.</p>
</li>
<li>
<p>Verify auto-update timer is active: <code>systemctl list-timers perfsonar-auto-update.timer</code>.</p>
</li>
</ul>
<hr />
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="networking-issues">Networking Issues<a class="headerlink" href="#networking-issues" title="Permanent link">&para;</a></h3>
<details class="failure">
<summary>Policy-based routing not working correctly</summary>
<p><strong>Symptoms:</strong> Traffic not using expected interfaces, routing to wrong gateway.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check routing rules</span>
ip<span class="w"> </span>rule<span class="w"> </span>show

<span class="c1"># Check routing tables</span>
ip<span class="w"> </span>route<span class="w"> </span>show<span class="w"> </span>table<span class="w"> </span>all


<span class="c1"># Test specific route lookup</span>
ip<span class="w"> </span>route<span class="w"> </span>get<span class="w"> </span>&lt;destination-ip&gt;

<span class="c1"># Check NetworkManager connections</span>
nmcli<span class="w"> </span>connection<span class="w"> </span>show

<span class="c1"># Review PBR script log</span>
tail<span class="w"> </span>-100<span class="w"> </span>/var/log/perfSONAR-multi-nic-config.log
</code></pre></div>
<p><strong>Solutions:</strong></p>
<ul>
<li>Verify <code>/etc/perfSONAR-multi-nic-config.conf</code> has correct IPs and gateways</li>
<li>Reapply configuration: <code>/opt/perfsonar-toolkit/tools_scripts/perfSONAR-pbr-nm.sh --yes</code></li>
<li>Reboot if rules are not being applied correctly</li>
<li>Check for conflicting NetworkManager or systemd-networkd rules</li>
</ul>
</details>
<details class="failure">
<summary>DNS resolution failing for test endpoints</summary>
<p><strong>Symptoms:</strong> perfSONAR tests fail with "unknown host" or DNS errors.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Test DNS resolution from container</span>
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>dig<span class="w"> </span>&lt;remote-testpoint&gt;

<span class="c1"># Check container&#39;s resolv.conf</span>

podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>cat<span class="w"> </span>/etc/resolv.conf

<span class="c1"># Verify forward and reverse DNS</span>
/opt/perfsonar-toolkit/tools_scripts/check-perfsonar-dns.sh
</code></pre></div>
<p><strong>Solutions:</strong></p>
<ul>
<li>Ensure DNS servers are correctly configured on host</li>
<li>Fix missing PTR records in DNS zones</li>
<li>Verify forward A/AAAA records match reverse PTR records</li>
</ul>
</details>
<h3 id="certificate-issues">Certificate Issues<a class="headerlink" href="#certificate-issues" title="Permanent link">&para;</a></h3>
<details class="failure">
<summary>Let's Encrypt certificate issuance fails</summary>
<p><strong>Symptoms:</strong> Certbot fails with "Failed to authenticate" or "Connection refused" errors.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check if port 80 is open</span>
nft<span class="w"> </span>list<span class="w"> </span>ruleset<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;80&quot;</span>

<span class="c1"># Verify Apache is NOT listening on port 80 in container</span>
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>perfsonar-testpoint<span class="w"> </span>netstat<span class="w"> </span>-tlnp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:80

<span class="c1"># Test port 80 accessibility from external host</span>
curl<span class="w"> </span>-v<span class="w"> </span>http://&lt;your-fqdn&gt;/

<span class="c1"># Run certbot in verbose mode</span>

podman<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--net<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/etc/letsencrypt:/etc/letsencrypt:Z<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/var/www/html:/var/www/html:Z<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>docker.io/certbot/certbot:latest<span class="w"> </span>certonly<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--standalone<span class="w"> </span>-d<span class="w"> </span>&lt;SERVER_FQDN&gt;<span class="w"> </span>-m<span class="w"> </span>&lt;EMAIL&gt;<span class="w"> </span>--dry-run<span class="w"> </span>-vvv
</code></pre></div>
<p><strong>Common causes:</strong></p>
<ul>
<li>Port 80 blocked by firewall: Add with <code>perfSONAR-install-nftables.sh --ports=80,443</code></li>
<li>Apache listening on port 80: Verify testpoint-entrypoint-wrapper.sh patched Apache correctly</li>
<li>DNS not propagated: Wait for DNS changes to propagate globally</li>
<li>Rate limiting: Let's Encrypt has rate limits; wait if you've hit them</li>
</ul>
</details>
<details class="failure">
<summary>Certificate not loaded after renewal</summary>
<p><strong>Symptoms:</strong> Old certificate still in use after automatic renewal.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check certificate files</span>
ls<span class="w"> </span>-la<span class="w"> </span>/etc/letsencrypt/live/&lt;fqdn&gt;/

<span class="c1"># Verify deploy hook is configured</span>
podman<span class="w"> </span>logs<span class="w"> </span>certbot<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;deploy hook&quot;</span>

<span class="c1"># Check if container restarted</span>
podman<span class="w"> </span>ps<span class="w"> </span>--format<span class="w"> </span><span class="s1">&#39;table {{.Names}}\t{{.Status}}&#39;</span>

<span class="c1"># Manually restart testpoint</span>
podman<span class="w"> </span>restart<span class="w"> </span>perfsonar-testpoint
</code></pre></div>
<p><strong>Solutions:</strong></p>
<ul>
<li>Verify deploy hook script exists and is executable: <code>/opt/perfsonar-toolkit/tools_scripts/certbot-deploy-hook.sh</code></li>
<li>Ensure deploy hook is mounted in container at: <code>/etc/letsencrypt/renewal-hooks/deploy/certbot-deploy-hook.sh</code></li>
<li>Verify Podman socket is mounted in certbot container: <code>/run/podman/podman.sock</code></li>
<li>Check deploy hook logs: <code>journalctl -u perfsonar-certbot.service | grep deploy</code></li>
<li>Manually restart testpoint after renewals if deploy hook fails: <code>podman restart perfsonar-testpoint</code></li>
</ul>
<p><strong>Note:</strong> Certbot automatically executes scripts in <code>/etc/letsencrypt/renewal-hooks/deploy/</code> when certificates are
renewed. Do not use <code>--deploy-hook</code> parameter with full paths ending in <code>.sh</code> as certbot will append <code>-hook</code> to the filename.</p>
</details>
<h3 id="perfsonar-service-issues">perfSONAR Service Issues<a class="headerlink" href="#perfsonar-service-issues" title="Permanent link">&para;</a></h3>
<details class="failure">
<summary>perfSONAR services not running</summary>
<p><strong>Symptoms:</strong> Web interface not accessible, tests not running.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check service status inside container</span>
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>perfsonar-testpoint<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>apache2
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>perfsonar-testpoint<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>pscheduler-ticker
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>perfsonar-testpoint<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>owamp-server

<span class="c1"># Check for errors in service logs</span>
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>perfsonar-testpoint<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>apache2<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span>
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>perfsonar-testpoint<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>pscheduler-ticker<span class="w"> </span>-n<span class="w"> </span><span class="m">50</span>
</code></pre></div>
<p><strong>Solutions:</strong></p>
<ul>
<li>Restart services inside container: <code>podman exec perfsonar-testpoint systemctl restart apache2</code></li>
<li>Check Apache SSL configuration was patched correctly</li>
<li>Verify certificates are in place: <code>ls -la /etc/letsencrypt/live/</code></li>
<li>Restart container: <code>podman restart perfsonar-testpoint</code></li>
</ul>
</details>
<h3 id="auto-update-issues">Auto-Update Issues<a class="headerlink" href="#auto-update-issues" title="Permanent link">&para;</a></h3>
<details class="failure">
<summary>Auto-update not working</summary>
<p><strong>Symptoms:</strong> Containers not updating despite new images available.</p>
<p><strong>Diagnostic steps:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check timer status</span>
systemctl<span class="w"> </span>status<span class="w"> </span>perfsonar-auto-update.timer
systemctl<span class="w"> </span>list-timers<span class="w"> </span>perfsonar-auto-update.timer

<span class="c1"># Check service logs</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>perfsonar-auto-update.service<span class="w"> </span>-n<span class="w"> </span><span class="m">100</span>

<span class="c1"># Check update log</span>
tail<span class="w"> </span>-50<span class="w"> </span>/var/log/perfsonar-auto-update.log

<span class="c1"># Manually test update</span>
systemctl<span class="w"> </span>start<span class="w"> </span>perfsonar-auto-update.service
</code></pre></div>
<p><strong>Solutions:</strong></p>
<ul>
<li>Enable timer if not active: <code>systemctl enable --now perfsonar-auto-update.timer</code></li>
<li>Verify script exists and is executable: <code>ls -la /usr/local/bin/perfsonar-auto-update.sh</code></li>
<li>Check podman-compose is installed and working</li>
<li>Review script for errors and update if needed</li>
</ul>
</details>
<h3 id="general-debugging-tips">General Debugging Tips<a class="headerlink" href="#general-debugging-tips" title="Permanent link">&para;</a></h3>
<details class="tip">
<summary>Useful debugging commands</summary>
<p><strong>Container management:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># View all containers (running and stopped)</span>
podman<span class="w"> </span>ps<span class="w"> </span>-a

<span class="c1"># View container resource usage</span>
podman<span class="w"> </span>stats

<span class="c1"># Enter container for interactive debugging</span>
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>/bin/bash

<span class="c1"># View compose configuration</span>
<span class="nb">cd</span><span class="w"> </span>/opt/perfsonar-toolkit<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>podman-compose<span class="w"> </span>config
</code></pre></div>
<p><strong>Networking:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check which process is listening on a port</span>
ss<span class="w"> </span>-tlnp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>&lt;port&gt;

<span class="c1"># Test connectivity to remote testpoint</span>
ping<span class="w"> </span>&lt;remote-ip&gt;
traceroute<span class="w"> </span>&lt;remote-ip&gt;

<span class="c1"># Check nftables rules</span>
nft<span class="w"> </span>list<span class="w"> </span>ruleset
</code></pre></div>
<p><strong>Logs:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># System journal for container runtime</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>podman<span class="w"> </span>-n<span class="w"> </span><span class="m">100</span>

<span class="c1"># All logs from a container</span>
podman<span class="w"> </span>logs<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>--tail<span class="o">=</span><span class="m">100</span>

<span class="c1"># Follow logs in real-time</span>
podman<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>perfsonar-testpoint
</code></pre></div>
</details>
<hr />









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "toc.follow", "toc.integrate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>