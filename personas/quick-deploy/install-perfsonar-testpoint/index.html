
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://osg-htc.org/networking/personas/quick-deploy/install-perfsonar-testpoint/">
      
      
        <link rel="prev" href="../landing/">
      
      
        <link rel="next" href="../automated-setup/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Quickstart: perfSONAR Testpoint - OSG Networking Area</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","UA-69012-29"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","UA-69012-29",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=UA-69012-29",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installing-a-perfsonar-testpoint-for-wlcgosg" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OSG Networking Area" class="md-header__button md-logo" aria-label="OSG Networking Area" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OSG Networking Area
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quickstart: perfSONAR Testpoint
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/osg-htc/networking/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OSG Networking Area" class="md-nav__button md-logo" aria-label="OSG Networking Area" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OSG Networking Area
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/osg-htc/networking/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSG Networking Area
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Network Monitoring (perfSONAR)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Network Monitoring (perfSONAR)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar-in-osg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Motivation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/deployment-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation and Maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Frequently Asked Questions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Network Troubleshooting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Network Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../network-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../network-troubleshooting/osg-debugging-document/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSG Network Debugging Document
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Network Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Network Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/psetf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Infrastructure Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../osg-network-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Datastore and Streaming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../osg-network-analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Analytics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Personas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Personas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Quick Deploy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Quick Deploy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Landing
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Quickstart: perfSONAR Testpoint
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Quickstart: perfSONAR Testpoint
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites-and-planning" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites and Planning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-install-and-harden-el9" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1 – Install and Harden EL9
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-bootstrap-the-testpoint-and-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2 – Bootstrap the Testpoint and Tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-configure-policy-based-routing-pbr" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3 – Configure Policy-Based Routing (PBR)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3 – Configure Policy-Based Routing (PBR)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns-forward-and-reverse-entries-required" class="md-nav__link">
    <span class="md-ellipsis">
      DNS: forward and reverse entries (required)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-configure-nftables-selinux-and-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4 – Configure nftables, SELinux, and Fail2Ban
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-deploy-the-containerized-perfsonar-testpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5 – Deploy the Containerized perfSONAR Testpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 5 – Deploy the Containerized perfSONAR Testpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-a-testpoint-only-simplest" class="md-nav__link">
    <span class="md-ellipsis">
      Option A — Testpoint only (simplest)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-b-testpoint-lets-encrypt-shared-apache-and-certs" class="md-nav__link">
    <span class="md-ellipsis">
      Option B — Testpoint + Let’s Encrypt (shared Apache and certs)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Option B — Testpoint + Let’s Encrypt (shared Apache and certs)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-seed-host-directories-from-a-temporary-testpoint-container" class="md-nav__link">
    <span class="md-ellipsis">
      1) Seed host directories from a temporary testpoint container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-create-the-final-compose-with-shared-volumes-and-certbot" class="md-nav__link">
    <span class="md-ellipsis">
      2) Create the final compose with shared volumes and certbot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-obtain-your-first-lets-encrypt-certificate-one-time" class="md-nav__link">
    <span class="md-ellipsis">
      3) Obtain your first Let’s Encrypt certificate (one-time)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-register-and-configure-with-wlcgosg" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6 – Register and Configure with WLCG/OSG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6 – Register and Configure with WLCG/OSG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helper-script-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Script (Recommended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-lookup-service-registration-inside-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Update Lookup Service registration inside the container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-post-install-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 7 – Post-Install Validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ongoing-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      Ongoing Maintenance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ongoing Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-image-updates-and-safe-restarts" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic image updates and safe restarts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automated-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automated setup
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Troubleshooter
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Landing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/triage-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triage checklist
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Researcher
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Researcher
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Landing
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/fail2ban/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fail2ban
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/selinux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SELinux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/nftables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nftables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools & Scripts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tools & Scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scripts and tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/docker-compose.yml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compose bundle (docker-compose.yml)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LS registration updater (script)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/README-lsregistration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LS registration helpers (README)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Link-check tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites-and-planning" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites and Planning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-install-and-harden-el9" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1 – Install and Harden EL9
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-bootstrap-the-testpoint-and-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2 – Bootstrap the Testpoint and Tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-configure-policy-based-routing-pbr" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3 – Configure Policy-Based Routing (PBR)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3 – Configure Policy-Based Routing (PBR)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns-forward-and-reverse-entries-required" class="md-nav__link">
    <span class="md-ellipsis">
      DNS: forward and reverse entries (required)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-configure-nftables-selinux-and-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4 – Configure nftables, SELinux, and Fail2Ban
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-deploy-the-containerized-perfsonar-testpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5 – Deploy the Containerized perfSONAR Testpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 5 – Deploy the Containerized perfSONAR Testpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-a-testpoint-only-simplest" class="md-nav__link">
    <span class="md-ellipsis">
      Option A — Testpoint only (simplest)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-b-testpoint-lets-encrypt-shared-apache-and-certs" class="md-nav__link">
    <span class="md-ellipsis">
      Option B — Testpoint + Let’s Encrypt (shared Apache and certs)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Option B — Testpoint + Let’s Encrypt (shared Apache and certs)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-seed-host-directories-from-a-temporary-testpoint-container" class="md-nav__link">
    <span class="md-ellipsis">
      1) Seed host directories from a temporary testpoint container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-create-the-final-compose-with-shared-volumes-and-certbot" class="md-nav__link">
    <span class="md-ellipsis">
      2) Create the final compose with shared volumes and certbot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-obtain-your-first-lets-encrypt-certificate-one-time" class="md-nav__link">
    <span class="md-ellipsis">
      3) Obtain your first Let’s Encrypt certificate (one-time)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-register-and-configure-with-wlcgosg" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6 – Register and Configure with WLCG/OSG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6 – Register and Configure with WLCG/OSG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helper-script-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Script (Recommended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-lookup-service-registration-inside-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Update Lookup Service registration inside the container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-post-install-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 7 – Post-Install Validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ongoing-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      Ongoing Maintenance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ongoing Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-image-updates-and-safe-restarts" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic image updates and safe restarts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="installing-a-perfsonar-testpoint-for-wlcgosg">Installing a perfSONAR Testpoint for WLCG/OSG<a class="headerlink" href="#installing-a-perfsonar-testpoint-for-wlcgosg" title="Permanent link">&para;</a></h1>
<p>This guide walks WLCG/OSG site administrators through end-to-end installation, configuration, and validation of a perfSONAR testpoint on Enterprise Linux 9 (EL9). It uses automated tooling from this repository to streamline the process while accommodating site-specific requirements.</p>
<hr />
<h2 id="prerequisites-and-planning">Prerequisites and Planning<a class="headerlink" href="#prerequisites-and-planning" title="Permanent link">&para;</a></h2>
<p>Before you begin, gather the following information:</p>
<ul>
<li><strong>Hardware details:</strong> hostname, BMC/iLO/iDRAC credentials (if used), interface names, available storage.</li>
<li><strong>Network data:</strong> IPv4/IPv6 assignments for each NIC, default gateway, internal/external VLAN
  information, PSConfig registration URLs.</li>
<li><strong>Operational contacts:</strong> site admin email, OSG facility name, latitude/longitude.</li>
<li>
<p><strong>Repository artifacts:</strong> Scripts and configurations from the <a href="https://github.com/perfsonar/testpoint">perfsonar/testpoint</a> repository, installed to <code>/opt/perfsonar-tp/tools_scripts</code>.</p>
</li>
<li>
<p><strong>Existing perfSONAR configuration:</strong> If replacing an existing instance, back up <code>/etc/perfsonar/</code> files, especially <code>lsregistrationdaemon.conf</code>, and any container volumes. Use <code>perfSONAR-update-lsregistration.sh</code> to extract registration config.</p>
</li>
</ul>
<details class="info">
<summary>Quick capture of existing lsregistration config (if you have a src)</summary>
<p>Download temporarily:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-o<span class="w"> </span>/tmp/update-lsreg.sh
chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>/tmp/update-lsreg.sh
</code></pre></div>
<p>Use the downloaded tool to extract a restore script:</p>
<div class="highlight"><pre><span></span><code>/tmp/update-lsreg.sh<span class="w"> </span>extract<span class="w"> </span>--output<span class="w"> </span>/root/restore-lsreg.sh
</code></pre></div>
</details>
<p>Note: Repository clone instructions are in Step 2.</p>
<blockquote>
<p><strong>Note:</strong> All shell commands assume an interactive root shell.</p>
</blockquote>
<hr />
<h2 id="step-1-install-and-harden-el9">Step 1 – Install and Harden EL9<a class="headerlink" href="#step-1-install-and-harden-el9" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Provision EL9:</strong> Install AlmaLinux, Rocky Linux, or RHEL 9 with the <em>Minimal</em> profile.</p>
</li>
<li>
<p><strong>Set the hostname and time sync:</strong> Pick the NIC that will own the default route for the hostname.</p>
<div class="highlight"><pre><span></span><code>hostnamectl<span class="w"> </span>set-hostname<span class="w"> </span>&lt;testpoint-hostname&gt;
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>chronyd
timedatectl<span class="w"> </span>set-timezone<span class="w"> </span>&lt;Region/City&gt;
</code></pre></div>
</li>
<li>
<p><strong>Disable unused services:</strong></p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>disable<span class="w"> </span>--now<span class="w"> </span>firewalld<span class="w"> </span>NetworkManager-wait-online
dnf<span class="w"> </span>remove<span class="w"> </span>-y<span class="w"> </span>rsyslog
</code></pre></div>
<details class="info">
<summary>Why disable unused services?</summary>
<p>We recommend disabling unused services during initial provisioning to
reduce complexity and avoid unexpected interference with network and
container setup. Services such as <code>firewalld</code>, <code>NetworkManager-wait-online</code>,
and <code>rsyslog</code> can alter networking state, hold boot or network events,
or conflict with the automated nftables/NetworkManager changes performed
by the helper scripts. Disabling non-essential services makes the
install deterministic, reduces the host attack surface, and avoids
delays or race conditions while configuring policy-based routing,
nftables rules, and container networking.</p>
</details>
</li>
<li>
<p><strong>Record NIC names:</strong> Document interface mappings for later PBR configuration.</p>
<div class="highlight"><pre><span></span><code>nmcli<span class="w"> </span>device<span class="w"> </span>status
ip<span class="w"> </span>-br<span class="w"> </span>addr
</code></pre></div>
</li>
</ol>
<hr />
<h2 id="step-2-bootstrap-the-testpoint-and-tools">Step 2 – Bootstrap the Testpoint and Tools<a class="headerlink" href="#step-2-bootstrap-the-testpoint-and-tools" title="Permanent link">&para;</a></h2>
<p>Use the bootstrap script to clone the perfSONAR testpoint repository into <code>/opt/perfsonar-tp</code> and install helper scripts under <code>/opt/perfsonar-tp/tools_scripts</code>.</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/install_tools_scripts.sh<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>/tmp/install_tools_scripts.sh
chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>/tmp/install_tools_scripts.sh
/tmp/install_tools_scripts.sh<span class="w"> </span>/opt/perfsonar-tp
</code></pre></div>
<p>After this step scripts are available at <code>/opt/perfsonar-tp/tools_scripts</code>.</p>
<blockquote>
<p><strong>Note:</strong> All shell commands assume an interactive root shell. Prefix with <code>sudo</code> when running as a non-root user.</p>
</blockquote>
<hr />
<ol>
<li>
<p><strong>Apply baseline updates and verify dependencies:</strong></p>
<p>Use the helper to check for required tools and apply OS updates.</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-tp/tools_scripts/check-deps.sh
</code></pre></div>
</li>
</ol>
<details class="tip">
<summary>Alternative: check-deps.sh one-off run without installing tools</summary>
<div class="codehilite"><pre><span></span><code><span class="err">```</span><span class="n">bash</span>
<span class="c1"># Preferred: run from the installed tools path (see Step 2):</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">-</span><span class="n">tp</span><span class="o">/</span><span class="n">tools_scripts</span><span class="o">/</span><span class="n">check</span><span class="o">-</span><span class="n">deps</span><span class="o">.</span><span class="n">sh</span>

<span class="c1"># If you must run it without installing the tools, download to /tmp and run</span>
<span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">fsSL</span><span class="w"> </span>\
<span class="w">    </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">osg</span><span class="o">-</span><span class="n">htc</span><span class="o">/</span><span class="n">networking</span><span class="o">/</span><span class="k">master</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">tools_scripts</span><span class="o">/</span><span class="n">check</span><span class="o">-</span><span class="n">deps</span><span class="o">.</span><span class="n">sh</span><span class="w"> </span>\
<span class="w">    </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">check</span><span class="o">-</span><span class="n">deps</span><span class="o">.</span><span class="n">sh</span>
<span class="n">chmod</span><span class="w"> </span><span class="mi">0755</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">check</span><span class="o">-</span><span class="n">deps</span><span class="o">.</span><span class="n">sh</span>
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">check</span><span class="o">-</span><span class="n">deps</span><span class="o">.</span><span class="n">sh</span>
<span class="err">```</span>
</code></pre></div>

</details>
<h2 id="step-3-configure-policy-based-routing-pbr">Step 3 – Configure Policy-Based Routing (PBR)<a class="headerlink" href="#step-3-configure-policy-based-routing-pbr" title="Permanent link">&para;</a></h2>
<p>The script <code>/opt/perfsonar-tp/tools_scripts/perfSONAR-pbr-nm.sh</code> automates NetworkManager profiles and routing rule setup.  It attempts to fill out the needed network configuraiton in <code>/etc/perfSONAR-multi-nic-config.conf</code></p>
<ol>
<li>
<p><strong>Generate config file automatically:</strong></p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-tp/tools_scripts/perfSONAR-pbr-nm.sh<span class="w"> </span>--generate-config-auto
</code></pre></div>
<p>Write the config file to <code>/etc/perfSONAR-multi-nic-config.conf</code>. Open and adjust site-specific values (e.g., confirm <code>DEFAULT_ROUTE_NIC</code>, add <code>NIC_IPV4_ADDROUTE</code> entries).</p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Gateways required for addresses</p>
<p>Any NIC with an IPv4 address must also have an IPv4 gateway, and any NIC with an IPv6 address
must have an IPv6 gateway. If the generator cannot detect a gateway, it adds a WARNING block
to the generated file listing affected NICs. Edit <code>NIC_IPV4_GWS</code>/<code>NIC_IPV6_GWS</code> accordingly
before applying changes.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Gateway prompts</p>
<p>During generation, the script attempts to detect gateways per-NIC. If a NIC has an IP address
but no gateway could be determined, it will prompt you interactively to enter an IPv4 and/or
IPv6 gateway (or <code>-</code> to skip). Prompts are skipped in non-interactive sessions or when you
use <code>--yes</code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Connect via console for network changes</p>
<p>When applying network changes across an ssh connection, your session may be interrupted.   Please try to run the perfSONAR-pbr-nm.sh script when connected either direcatly to the console or by using 'nohup' in front of the script invocation.</p>
</div>
<ol>
<li>
<p><strong>Apply changes:</strong></p>
<p>Apply non-interactively with <code>--yes</code> or interactively without:</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-tp/tools_scripts/perfSONAR-pbr-nm.sh<span class="w"> </span>--yes
</code></pre></div>
<p>The script backs up NetworkManager profiles, seeds routing tables, and applies rules. Review <code>/var/log/perfSONAR-multi-nic-config.log</code> and retain it. Reboot if needed.</p>
</li>
</ol>
<h3 id="dns-forward-and-reverse-entries-required">DNS: forward and reverse entries (required)<a class="headerlink" href="#dns-forward-and-reverse-entries-required" title="Permanent link">&para;</a></h3>
<p>All IP addresses that will be used for perfSONAR testing MUST have DNS entries: a forward (A/AAAA)
record and a matching reverse (PTR) record. This is required so remote test tools and site operators
can reliably reach and identify your host, and because some measurement infrastructure and
registration systems perform forward/reverse consistency checks.</p>
<ul>
<li>For single-stack IPv4-only hosts: ensure A and PTR are present and consistent.</li>
<li>For single-stack IPv6-only hosts: ensure AAAA and PTR are present and consistent.</li>
<li>For dual-stack hosts: both IPv4 and IPv6 addresses used for testing must have matching forward and
  reverse records (A+PTR and AAAA+PTR).</li>
</ul>
<details class="example">
<summary>Run the DNS checker</summary>
<p>Validate forward/reverse DNS for addresses in <code>/etc/perfSONAR-multi-nic-config.conf</code>.</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-tp/tools_scripts/check-perfsonar-dns.sh
</code></pre></div>
<p>Or download temporarily:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/check-perfsonar-dns.sh<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>/tmp/check-dns.sh
chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>/tmp/check-dns.sh
/tmp/check-dns.sh
</code></pre></div>
<p><strong>Notes and automation tips:</strong></p>
<ul>
<li>The script above uses <code>dig</code> (bind-utils package) which is commonly available; you can adapt it
  to use <code>host</code> if preferred.</li>
<li>Run the check as part of your provisioning CI or as a pre-flight check before enabling measurement registration.</li>
<li>For large sites or many addresses, parallelize the checks (xargs -P) or use a small Python
  script that leverages <code>dns.resolver</code> for async checks.</li>
<li>If your PTR returns a hostname with a trailing dot, the script strips it before the forward check.</li>
</ul>
</details>
<p>If any addresses fail these checks, correct the DNS zone (forward and/or reverse) and allow DNS
propagation before proceeding with registration and testing.</p>
<!-- Consolidated DNS checker instructions into a single admonition above -->

<ol>
<li><strong>Verify the routing policy:</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>nmcli<span class="w"> </span>connection<span class="w"> </span>show
ip<span class="w"> </span>rule<span class="w"> </span>show
ip<span class="w"> </span>route<span class="w"> </span>show<span class="w"> </span>table<span class="w"> </span>&lt;table-id&gt;
</code></pre></div>
<p>Confirm that non-default interfaces have their own routing tables and that the default interface
owns the system default route.</p>
<hr />
<h2 id="step-4-configure-nftables-selinux-and-fail2ban">Step 4 – Configure nftables, SELinux, and Fail2Ban<a class="headerlink" href="#step-4-configure-nftables-selinux-and-fail2ban" title="Permanent link">&para;</a></h2>
<p>Use <code>/opt/perfsonar-tp/tools_scripts/perfSONAR-install-nftables.sh</code> to configure a hardened nftables profile with optional SELinux and Fail2Ban support. No staging or copy step is required.</p>
<p>Prerequisites (not installed by the script):</p>
<ul>
<li><code>nftables</code> must already be installed and available (<code>nft</code> binary) for firewall configuration.</li>
<li><code>fail2ban</code> must be installed if you want the optional jail configuration.</li>
<li>SELinux tools (e.g., <code>getenforce</code>, <code>policycoreutils</code>) must be present to attempt SELinux configuration.</li>
</ul>
<p>If any prerequisite is missing, the script skips that component and continues.</p>
<ol>
<li>
<p><strong>Run with desired options:</strong></p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-tp/tools_scripts/perfSONAR-install-nftables.sh<span class="w"> </span>--selinux<span class="w"> </span>--fail2ban<span class="w"> </span>--yes
</code></pre></div>
<ul>
<li>Use <code>--yes</code> to skip the interactive confirmation prompt (omit it if you prefer to review the
  summary and answer manually).</li>
<li>Add <code>--dry-run</code> for a rehearsal that only prints the planned actions.</li>
</ul>
<p>The script writes nftables rules for perfSONAR services, derives SSH allow-lists from
<code>/etc/perfSONAR-multi-nic-config.conf</code>, optionally adjusts SELinux, and enables Fail2Ban
jails—only if those components are already installed.</p>
</li>
</ol>
<details class="info">
<summary>SSH allow-lists and validation</summary>
<ul>
<li>Derives SSH allow-lists from <code>/etc/perfSONAR-multi-nic-config.conf</code> (CIDR prefixes and addresses).</li>
<li>Validates nftables rules before writing.</li>
<li>Outputs: rules to <code>/etc/nftables.d/perfsonar.nft</code>, log to <code>/var/log/perfSONAR-install-nftables.log</code>, backups to <code>/var/backups/</code>.</li>
</ul>
</details>
<details class="tip">
<summary>Preview nftables rules before applying</summary>
<p>You can preview the fully rendered nftables rules (no changes are made):</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-tp/tools_scripts/perfSONAR-install-nftables.sh<span class="w"> </span>--print-rules
</code></pre></div>
</details>
<details class="tip">
<summary>Manually add extra management hosts/subnets</summary>
<p>If you need to allow additional SSH sources not represented by your NIC-derived prefixes,
edit <code>/etc/nftables.d/perfsonar.nft</code> and add entries to the appropriate sets. Example:</p>
<div class="highlight"><pre><span></span><code>set ssh_access_ip4_subnets {
    type ipv4_addr
    flags interval
    elements = { 192.0.2.0/24, 198.51.100.0/25 }
}

set ssh_access_ip4_hosts {
    type ipv4_addr
    elements = { 203.0.113.10, 203.0.113.11 }
}

set ssh_access_ip6_subnets {
    type ipv6_addr
    flags interval
    elements = { 2001:db8:1::/64 }
}

set ssh_access_ip6_hosts {
    type ipv6_addr
    elements = { 2001:db8::10 }
}
</code></pre></div>
</details>
<p>Then validate and reload (root shell):</p>
<div class="highlight"><pre><span></span><code>nft<span class="w"> </span>-c<span class="w"> </span>-f<span class="w"> </span>/etc/nftables.d/perfsonar.nft
systemctl<span class="w"> </span>reload<span class="w"> </span>nftables<span class="w"> </span><span class="o">||</span><span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nftables
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="o">**</span><span class="n">Confirm</span><span class="w"> </span><span class="n">firewall</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">services</span><span class="p">:</span><span class="o">**</span>
</code></pre></div>

<details class="info">
<summary>Verification commands</summary>
<div class="highlight"><pre><span></span><code>nft<span class="w"> </span>list<span class="w"> </span>ruleset
sestatus
systemctl<span class="w"> </span>status<span class="w"> </span>fail2ban
</code></pre></div>
<p>Document any site-specific exceptions (e.g., additional allowed management hosts) in your change log.</p>
<hr />
</details>
<h2 id="step-5-deploy-the-containerized-perfsonar-testpoint">Step 5 – Deploy the Containerized perfSONAR Testpoint<a class="headerlink" href="#step-5-deploy-the-containerized-perfsonar-testpoint" title="Permanent link">&para;</a></h2>
<p>Run the official testpoint image using Podman or Docker. Choose one of the two deployment modes:</p>
<ul>
<li>Option A: Testpoint only (simplest) — only bind-mount <code>/opt/perfsonar-tp/psconfig</code> for pSConfig.</li>
<li>Option B: Testpoint + Let’s Encrypt — two containers that share Apache files and certs via
    host bind mounts.</li>
</ul>
<p>Use <code>podman-compose</code> or <code>docker-compose</code> in the examples below.</p>
<h3 id="option-a-testpoint-only-simplest">Option A — Testpoint only (simplest)<a class="headerlink" href="#option-a-testpoint-only-simplest" title="Permanent link">&para;</a></h3>
<p>Prepare the pSConfig directory and a minimal compose file. No other host bind-mounts are required.</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/perfsonar-tp/psconfig
</code></pre></div>
<p>Download a ready-made compose file (or copy it manually):<br />
Browse: <a href="https://github.com/osg-htc/networking/blob/master/docs/perfsonar/tools_scripts/docker-compose.testpoint.yml">repo view</a></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/docker-compose.testpoint.yml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>/opt/perfsonar-tp/docker-compose.yml
</code></pre></div>
<p>Or create <code>/opt/perfsonar-tp/docker-compose.yml</code> with:</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.9&quot;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">testpoint</span><span class="p">:</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">perfsonar-testpoint</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub.opensciencegrid.org/osg-htc/perfsonar-testpoint:5.2.3-systemd</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">network_mode</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span>
<span class="w">        </span><span class="nt">cgroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=UTC</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">        </span><span class="nt">tmpfs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run/lock</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys/fs/cgroup:/sys/fs/cgroup:rw</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/perfsonar-tp/psconfig:/etc/perfsonar/psconfig:Z</span>
<span class="w">        </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">pids_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8192</span>
<span class="w">        </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CAP_NET_RAW</span>
</code></pre></div>
<p>Bring it up:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="nb">cd</span><span class="w"> </span>/opt/perfsonar-tp<span class="p">;</span><span class="w"> </span>podman-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="o">)</span><span class="w">  </span><span class="c1"># or: (cd /opt/perfsonar-tp; docker-compose up -d)</span>
</code></pre></div>
<p>That’s it for the testpoint-only mode. Manage pSConfig files under <code>/opt/perfsonar-tp/psconfig</code> on
the host; they are consumed by the container at <code>/etc/perfsonar/psconfig</code>.</p>
<hr />
<h3 id="option-b-testpoint-lets-encrypt-shared-apache-and-certs">Option B — Testpoint + Let’s Encrypt (shared Apache and certs)<a class="headerlink" href="#option-b-testpoint-lets-encrypt-shared-apache-and-certs" title="Permanent link">&para;</a></h3>
<p>This mode runs two containers (<code>testpoint</code> and <code>certbot</code>) and bind-mounts the following host paths
so Apache content and certificates persist on the host and are shared:</p>
<ul>
<li><code>/var/www/html</code> — webroot used for HTTP-01 challenges</li>
<li><code>/etc/apache2</code> — Apache configuration</li>
<li><code>/etc/letsencrypt</code> — Let’s Encrypt certs and state</li>
</ul>
<h4 id="1-seed-host-directories-from-a-temporary-testpoint-container">1) Seed host directories from a temporary testpoint container<a class="headerlink" href="#1-seed-host-directories-from-a-temporary-testpoint-container" title="Permanent link">&para;</a></h4>
<p>Start a temporary testpoint without bind-mounts, then copy baseline content out to the host.</p>
<p>Create <code>/opt/perfsonar-tp/docker-compose.yml</code> (temporary) with:</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.9&quot;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">testpoint</span><span class="p">:</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">perfsonar-testpoint</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub.opensciencegrid.org/osg-htc/perfsonar-testpoint:5.2.3-systemd</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">network_mode</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span>
<span class="w">        </span><span class="nt">cgroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=UTC</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">        </span><span class="nt">tmpfs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run/lock</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys/fs/cgroup:/sys/fs/cgroup:rw</span>
<span class="w">        </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">pids_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8192</span>
<span class="w">        </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CAP_NET_RAW</span>
</code></pre></div>
<p>Bring it up and seed:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="nb">cd</span><span class="w"> </span>/opt/perfsonar-tp<span class="p">;</span><span class="w"> </span>podman-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="o">)</span><span class="w">  </span><span class="c1"># or docker-compose up -d</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/perfsonar-tp/psconfig<span class="w"> </span>/var/www/html<span class="w"> </span>/etc/apache2<span class="w"> </span>/etc/letsencrypt
docker<span class="w"> </span>cp<span class="w"> </span>perfsonar-testpoint:/etc/perfsonar/psconfig<span class="w"> </span>/opt/perfsonar-tp/psconfig
docker<span class="w"> </span>cp<span class="w"> </span>perfsonar-testpoint:/var/www/html<span class="w"> </span>/var/www/html
docker<span class="w"> </span>cp<span class="w"> </span>perfsonar-testpoint:/etc/apache2<span class="w"> </span>/etc/apache2
<span class="c1"># Seed /etc/letsencrypt from the certbot image (may be minimal; populated on first issuance)</span>
docker<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>certbot-seed<span class="w"> </span>certbot/certbot<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
docker<span class="w"> </span>cp<span class="w"> </span>certbot-seed:/etc/letsencrypt<span class="w"> </span>/etc/letsencrypt<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
docker<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>certbot-seed<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
</code></pre></div>
<p>If SELinux is enforcing, the <code>:z</code>/<code>:Z</code> options in the next step handle labels; no manual <code>chcon</code> is
required.</p>
<details class="note">
<summary>About /etc/letsencrypt seeding</summary>
<p>The <code>/etc/letsencrypt</code> directory is seeded from the Certbot image (not the testpoint)
to create the expected path on the host. This seed may be minimal or empty; it will be
populated during the initial certificate issuance in Step 5.3. Keeping the directory present
(even if empty) ensures the bind mount works and SELinux labels can be applied on enforcing
hosts.</p>
</details>
<p>Stop the temporary container before switching to the final compose:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="nb">cd</span><span class="w"> </span>/opt/perfsonar-tp<span class="p">;</span><span class="w"> </span>podman-compose<span class="w"> </span>down<span class="o">)</span><span class="w">  </span><span class="c1"># or docker-compose down</span>
</code></pre></div>
<h4 id="2-create-the-final-compose-with-shared-volumes-and-certbot">2) Create the final compose with shared volumes and certbot<a class="headerlink" href="#2-create-the-final-compose-with-shared-volumes-and-certbot" title="Permanent link">&para;</a></h4>
<p>Download a ready-made compose file (or copy it manually):<br />
Browse: <a href="https://github.com/osg-htc/networking/blob/master/docs/perfsonar/tools_scripts/docker-compose.testpoint-le.yml">repo view</a></p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/docker-compose.testpoint-le.yml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>/opt/perfsonar-tp/docker-compose.yml
</code></pre></div>
<p>Or create <code>/opt/perfsonar-tp/docker-compose.yml</code> with:</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.9&quot;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">testpoint</span><span class="p">:</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">perfsonar-testpoint</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub.opensciencegrid.org/osg-htc/perfsonar-testpoint:5.2.3-systemd</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">network_mode</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span>
<span class="w">        </span><span class="nt">cgroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=UTC</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">        </span><span class="nt">tmpfs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run/lock</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys/fs/cgroup:/sys/fs/cgroup:rw</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/perfsonar-tp/psconfig:/etc/perfsonar/psconfig:Z</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html:/var/www/html:z</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/apache2:/etc/apache2:z</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/letsencrypt:/etc/letsencrypt:z</span>
<span class="w">        </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">pids_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8192</span>
<span class="w">        </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CAP_NET_RAW</span>

<span class="w">    </span><span class="nt">certbot</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">certbot/certbot</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">certbot</span>
<span class="w">        </span><span class="nt">network_mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">        </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;trap</span><span class="nv"> </span><span class="s">exit</span><span class="nv"> </span><span class="s">TERM;</span><span class="nv"> </span><span class="s">while</span><span class="nv"> </span><span class="s">:;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">certbot</span><span class="nv"> </span><span class="s">renew;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">12h</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">wait</span><span class="nv"> </span><span class="s">$${!};</span><span class="nv"> </span><span class="s">done;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testpoint</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html:/var/www/html:z</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/letsencrypt:/etc/letsencrypt:z</span>
</code></pre></div>
<p>Start the final stack:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="nb">cd</span><span class="w"> </span>/opt/perfsonar-tp<span class="p">;</span><span class="w"> </span>podman-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="o">)</span><span class="w">  </span><span class="c1"># or docker-compose up -d</span>
</code></pre></div>
<h4 id="3-obtain-your-first-lets-encrypt-certificate-one-time">3) Obtain your first Let’s Encrypt certificate (one-time)<a class="headerlink" href="#3-obtain-your-first-lets-encrypt-certificate-one-time" title="Permanent link">&para;</a></h4>
<p>The <code>certbot</code> sidecar above will renew automatically. For the initial issuance, run:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--net<span class="o">=</span>host<span class="w"> </span>-v<span class="w"> </span>/var/www/html:/var/www/html<span class="w"> </span>-v<span class="w"> </span>/etc/letsencrypt:/etc/letsencrypt<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>certbot/certbot<span class="w"> </span>certonly<span class="w"> </span>--webroot<span class="w"> </span>-w<span class="w"> </span>/var/www/html<span class="w"> </span>-d<span class="w"> </span>&lt;SERVER_FQDN&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--email<span class="w"> </span>&lt;LETSENCRYPT_EMAIL&gt;<span class="w"> </span>--agree-tos<span class="w"> </span>--no-eff-email

<span class="c1"># Gracefully reload Apache within the testpoint container (or restart the service)</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>bash<span class="w"> </span>-lc<span class="w"> </span><span class="s1">&#39;systemctl reload httpd || apachectl -k graceful || true&#39;</span>
</code></pre></div>
<details class="info">
<summary>Notes</summary>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="nv">Ensure</span><span class="w"> </span><span class="nv">TCP</span><span class="w"> </span><span class="nv">port</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">host</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">reachable</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">internet</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">issuing</span><span class="w"> </span><span class="nv">certificates</span>.
<span class="o">-</span><span class="w"> </span><span class="nv">Shared</span><span class="w"> </span><span class="nv">paths</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">SELinux</span><span class="o">-</span><span class="nv">aware</span><span class="w"> </span>`:<span class="nv">z</span>`<span class="o">/</span>`:<span class="nv">Z</span>`<span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">permit</span><span class="w"> </span><span class="nv">container</span><span class="w"> </span><span class="nv">access</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">enforcing</span><span class="w"> </span><span class="nv">hosts</span>.
</code></pre></div>

</details>
<h2 id="step-6-register-and-configure-with-wlcgosg">Step 6 – Register and Configure with WLCG/OSG<a class="headerlink" href="#step-6-register-and-configure-with-wlcgosg" title="Permanent link">&para;</a></h2>
<p>We need to register your instance and ensure it is configured with the required meta data for the
lsregistration daemon (see below).</p>
<ol>
<li><strong>OSG/WLCG registration workflow:</strong></li>
</ol>
<details class="info">
<summary>Registration steps and portals</summary>
<ul>
<li>Register the host in <a href="https://topology.opensciencegrid.org/host">OSG topology</a>.</li>
<li>Create or update a <a href="https://ggus.eu/">GGUS</a> ticket announcing the new measurement point.<ul>
<li>In <a href="https://goc.egi.eu/portal/">GOCDB</a>, add the service endpoint
    <code>org.opensciencegrid.crc.perfsonar-testpoint</code> bound to this host.</li>
</ul>
</li>
</ul>
</details>
<ol>
<li><strong>pSConfig enrollment:</strong></li>
</ol>
<p>Register this host with the OSG/WLCG pSConfig service so tests are auto-configured. Use the "auto URL" for each FQDN you expose for perfSONAR (one or two depending on whether you split latency/throughput by hostname).</p>
<p>Basic enroll (interactive root on the host; runs inside the container):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Replace with your actual FQDNs (one or two)</span>
<span class="nv">FQDN_LAT</span><span class="o">=</span><span class="s2">&quot;&lt;latency.example.org&gt;&quot;</span>
<span class="nv">FQDN_BW</span><span class="o">=</span><span class="s2">&quot;&lt;throughput.example.org&gt;&quot;</span><span class="w">   </span><span class="c1"># optional if you use a second FQDN</span>

<span class="c1"># Add auto URLs (configures archives too) and show configured remotes</span>
podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>psconfig<span class="w"> </span>remote<span class="w"> </span>--configure-archives<span class="w"> </span>add<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;https://psconfig.opensciencegrid.org/pub/auto/</span><span class="si">${</span><span class="nv">FQDN_LAT</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FQDN_BW</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>psconfig<span class="w"> </span>remote<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--configure-archives<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;https://psconfig.opensciencegrid.org/pub/auto/</span><span class="si">${</span><span class="nv">FQDN_BW</span><span class="si">}</span><span class="s2">&quot;</span>

podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>psconfig<span class="w"> </span>remote<span class="w"> </span>list
<span class="c1"># or with Docker:</span>
<span class="c1"># docker exec -it perfsonar-testpoint psconfig remote list</span>
</code></pre></div>
<p>Remove any stale/old entries if present:</p>
<div class="highlight"><pre><span></span><code>podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>psconfig<span class="w"> </span>remote<span class="w"> </span>delete<span class="w"> </span><span class="s2">&quot;&lt;old-url&gt;&quot;</span>
</code></pre></div>
<p>Automation tip: derive FQDNs from your configured IPs (PTR lookup) and enroll automatically. Review the list before applying.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Build candidate FQDN list from IPs referenced in /etc/perfSONAR-multi-nic-config.conf</span>
mapfile<span class="w"> </span>-t<span class="w"> </span>PS_IPS<span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>awk<span class="w"> </span>-F<span class="o">=</span><span class="w"> </span><span class="s1">&#39;/^NIC_(IPV4|IPV6)_ADDRS=/ {gsub(/&quot;|\n/,&quot;&quot;,$2); split($2,a,/[ ,]/); for(i in a) if (a[i] != &quot;&quot; &amp;&amp; a[i] != &quot;-&quot;) print a[i]; }&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/etc/perfSONAR-multi-nic-config.conf<span class="o">)</span>

<span class="nv">FQDNS</span><span class="o">=()</span>
<span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PS_IPS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="c1"># Reverse lookup; prefer getent for libc resolution, fallback to dig -x</span>
<span class="w">    </span><span class="nv">name</span><span class="o">=</span><span class="k">$(</span>getent<span class="w"> </span>hosts<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$name</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">name</span><span class="o">=</span><span class="k">$(</span>dig<span class="w"> </span>+short<span class="w"> </span>-x<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n1<span class="k">)</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="nv">name</span><span class="o">=</span><span class="si">${</span><span class="nv">name</span><span class="p">%.</span><span class="si">}</span><span class="w">   </span><span class="c1"># strip trailing dot</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$name</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">FQDNS</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$name</span><span class="s2">&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="k">fi</span>
<span class="k">done</span>

<span class="c1"># Deduplicate while preserving order</span>
<span class="nv">uniq_fqdns</span><span class="o">=()</span>
<span class="k">for</span><span class="w"> </span>n<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FQDNS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">skip</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>u<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">uniq_fqdns</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$u</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$n</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">skip</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
<span class="w">    </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$skip</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">uniq_fqdns</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$n</span><span class="s2">&quot;</span><span class="o">)</span>
<span class="k">done</span>

<span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;Will enroll these FQDNs:\n&quot;</span><span class="p">;</span><span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot; - %s\n&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">uniq_fqdns</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Proceed with enrollment (y/N)? &quot;</span><span class="w"> </span>ans<span class="p">;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ans</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;y&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>

<span class="k">for</span><span class="w"> </span>fq<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">uniq_fqdns</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>psconfig<span class="w"> </span>remote<span class="w"> </span>--configure-archives<span class="w"> </span>add<span class="w"> </span><span class="se">\</span>
<span class="w">        </span><span class="s2">&quot;https://psconfig.opensciencegrid.org/pub/auto/</span><span class="si">${</span><span class="nv">fq</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">done</span>

podman<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>psconfig<span class="w"> </span>remote<span class="w"> </span>list
</code></pre></div>
<p>Verification: Confirm the files under <code>/etc/perfsonar/psconfig/pscheduler.d/</code> (inside the container) reflect the expected feeds and, where applicable, <code>ifaddr</code> entries match the intended interfaces.</p>
<h3 id="helper-script-recommended">Helper Script (Recommended)<a class="headerlink" href="#helper-script-recommended" title="Permanent link">&para;</a></h3>
<p>Instead of the ad-hoc automation snippet above, you can use the installed helper script:</p>
<div class="highlight"><pre><span></span><code>/opt/perfsonar-tp/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>--help

<span class="c1"># Typical usage (podman):</span>
/opt/perfsonar-tp/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>-v

<span class="c1"># Dry run only (show planned URLs):</span>
/opt/perfsonar-tp/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>-n

<span class="c1"># Non-interactive (CI) enrollment:</span>
/opt/perfsonar-tp/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>-y

<span class="c1"># If your container name differs:</span>
/opt/perfsonar-tp/tools_scripts/perfSONAR-auto-enroll-psconfig.sh<span class="w"> </span>-c<span class="w"> </span>my-ps-testpoint
</code></pre></div>
<p>The script:</p>
<ul>
<li>Parses IP lists from <code>/etc/perfSONAR-multi-nic-config.conf</code> (<code>NIC_IPV4_ADDRS</code> / <code>NIC_IPV6_ADDRS</code>).</li>
<li>Performs reverse DNS lookups (getent/dig) to derive FQDNs.</li>
<li>Deduplicates while preserving discovery order.</li>
<li>Adds each <code>https://psconfig.opensciencegrid.org/pub/auto/&lt;FQDN&gt;</code> with <code>--configure-archives</code>.</li>
<li>Lists configured remotes and returns non-zero if any enrollment fails.</li>
</ul>
<p>Integrate into provisioning CI by running with <code>-n</code> (dry-run) for approval and then <code>-y</code> once approved.</p>
<ol>
<li><strong>Document memberships:</strong> update your site wiki or change log with assigned mesh names, feed
   URLs, and support contacts.</li>
</ol>
<h3 id="update-lookup-service-registration-inside-the-container">Update Lookup Service registration inside the container<a class="headerlink" href="#update-lookup-service-registration-inside-the-container" title="Permanent link">&para;</a></h3>
<p>Use the helper script to edit <code>/etc/perfsonar/lsregistrationdaemon.conf</code> inside the running
<code>perfsonar-testpoint</code> container and restart the daemon only if needed.</p>
<p>Install and run examples (root shell):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Preview changes only (uses the copy from /opt/perfsonar-tp/tools_scripts)</span>
/opt/perfsonar-tp/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dry-run<span class="w"> </span>--site-name<span class="w"> </span><span class="s2">&quot;Acme Co.&quot;</span><span class="w"> </span>--project<span class="w"> </span>WLCG<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--admin-email<span class="w"> </span>admin@example.org<span class="w"> </span>--admin-name<span class="w"> </span><span class="s2">&quot;pS Admin&quot;</span>

<span class="c1"># Restore previously saved settings from the Prerequisites extract (if you saved a restore script earlier)</span>
bash<span class="w"> </span>/root/restore-lsreg.sh

<span class="c1"># Apply new settings and restart the daemon inside the container</span>
/opt/perfsonar-tp/tools_scripts/perfSONAR-update-lsregistration.sh<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--site-name<span class="w"> </span><span class="s2">&quot;Acme Co.&quot;</span><span class="w"> </span>--domain<span class="w"> </span>example.org<span class="w"> </span>--project<span class="w"> </span>WLCG<span class="w"> </span>--project<span class="w"> </span>OSG<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--city<span class="w"> </span>Berkeley<span class="w"> </span>--region<span class="w"> </span>CA<span class="w"> </span>--country<span class="w"> </span>US<span class="w"> </span>--zip<span class="w"> </span><span class="m">94720</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--latitude<span class="w"> </span><span class="m">37</span>.5<span class="w"> </span>--longitude<span class="w"> </span>-121.7469<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--admin-name<span class="w"> </span><span class="s2">&quot;pS Admin&quot;</span><span class="w"> </span>--admin-email<span class="w"> </span>admin@example.org
</code></pre></div>
<h2 id="step-7-post-install-validation">Step 7 – Post-Install Validation<a class="headerlink" href="#step-7-post-install-validation" title="Permanent link">&para;</a></h2>
<p>Perform these checks before handing the host over to operations:</p>
<ol>
<li><strong>System services:</strong></li>
</ol>
<details class="info">
<summary>Verify Podman and compose services</summary>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>podman
systemctl<span class="w"> </span>--user<span class="w"> </span>status<span class="w"> </span>podman-compose@perfsonar-testpoint.service
</code></pre></div>
<p>Ensure both are active/green.</p>
</details>
<ol>
<li><strong>Container health:</strong></li>
</ol>
<details class="info">
<summary>Check container status and logs</summary>
<div class="highlight"><pre><span></span><code>podman<span class="w"> </span>ps<span class="w"> </span>--format<span class="w"> </span><span class="s1">&#39;table {{.Names}}\t{{.Status}}\t{{.Ports}}&#39;</span>
podman<span class="w"> </span>logs<span class="w"> </span>pscheduler-agent<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail
</code></pre></div>
</details>
<ol>
<li><strong>Network path validation:</strong></li>
</ol>
<details class="info">
<summary>Test network connectivity and routing</summary>
<div class="highlight"><pre><span></span><code>pscheduler<span class="w"> </span>task<span class="w"> </span>throughput<span class="w"> </span>--dest<span class="w"> </span>&lt;remote-testpoint&gt;
tracepath<span class="w"> </span>-n<span class="w"> </span>&lt;remote-testpoint&gt;
</code></pre></div>
<p>Confirm traffic uses the intended policy-based routes (check <code>ip route get &lt;dest&gt;</code>).</p>
</details>
<ol>
<li><strong>Security posture:</strong></li>
</ol>
<details class="info">
<summary>Check firewall, fail2ban, and SELinux</summary>
<div class="highlight"><pre><span></span><code>nft<span class="w"> </span>list<span class="w"> </span>ruleset<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>perfsonar
fail2ban-client<span class="w"> </span>status
ausearch<span class="w"> </span>--message<span class="w"> </span>AVC<span class="w"> </span>--just-one
</code></pre></div>
<p>Investigate any SELinux denials or repeated Fail2Ban bans.</p>
</details>
<ol>
<li><strong>LetsEncrypt certificate check:</strong></li>
</ol>
<details class="info">
<summary>Verify certificate validity</summary>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>&lt;SERVER_FQDN&gt;:443<span class="w"> </span>-servername<span class="w"> </span>&lt;SERVER_FQDN&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-dates<span class="w"> </span>-issuer
</code></pre></div>
<p>Ensure the issuer is Let’s Encrypt and the validity period is acceptable.</p>
</details>
<ol>
<li><strong>Reporting:</strong></li>
</ol>
<details class="info">
<summary>Run perfSONAR diagnostic reports</summary>
<p>Run the perfSONAR toolkit daily report and send outputs to operations:</p>
<div class="highlight"><pre><span></span><code>pscheduler<span class="w"> </span>troubleshoot
toolkit-system-health
</code></pre></div>
<hr />
</details>
<h2 id="ongoing-maintenance">Ongoing Maintenance<a class="headerlink" href="#ongoing-maintenance" title="Permanent link">&para;</a></h2>
<ul>
<li>Schedule quarterly re-validation of routing policy and nftables rules.</li>
<li>Apply <code>dnf update</code> monthly and reboot during the next maintenance window.</li>
<li>Monitor psconfig feeds for changes in mesh participation.</li>
<li>Track certificate expiry (<code>certbot renew --dry-run</code>) if you rely on Let’s Encrypt.</li>
</ul>
<h3 id="automatic-image-updates-and-safe-restarts">Automatic image updates and safe restarts<a class="headerlink" href="#automatic-image-updates-and-safe-restarts" title="Permanent link">&para;</a></h3>
<p>Keep containers current and only restart them when their image actually changes.</p>
<details class="info">
<summary>Auto-update via labels and a systemd timer</summary>
<ol>
<li>
<p>Add an auto-update label to services in your compose file (both <code>testpoint</code> and <code>certbot</code> if used):</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">testpoint</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># ...</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>

<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">io.containers.autoupdate=registry</span>

<span class="w">    </span><span class="nt">certbot</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># ...</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>

<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">io.containers.autoupdate=registry</span>
</code></pre></div>
<p>This instructs Podman to check the registry for newer images and restart only if an update is pulled.</p>
</li>
<li>
<p>Enable the Podman auto-update timer (runs daily by default):</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>podman-auto-update.timer
</code></pre></div>
</li>
<li>
<p>Run ad-hoc when desired and preview:</p>
<div class="highlight"><pre><span></span><code>podman<span class="w"> </span>auto-update<span class="w"> </span>--dry-run
podman<span class="w"> </span>auto-update
</code></pre></div>
</li>
<li>
<p>Inspect recent runs:</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>list-timers<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>podman-auto-update
journalctl<span class="w"> </span>-u<span class="w"> </span>podman-auto-update<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;1 day ago&quot;</span>
</code></pre></div>
</li>
</ol>
</details>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>