
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://osg-htc.org/networking/personas/quick-deploy/install-perfsonar-testpoint/">
      
      
        <link rel="prev" href="../landing/">
      
      
        <link rel="next" href="../automated-setup/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Quickstart: perfSONAR Testpoint - OSG Networking Area</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","UA-69012-29"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","UA-69012-29",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=UA-69012-29",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installing-a-perfsonar-testpoint-for-wlcgosg" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OSG Networking Area" class="md-header__button md-logo" aria-label="OSG Networking Area" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OSG Networking Area
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quickstart: perfSONAR Testpoint
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/osg-htc/networking/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OSG Networking Area" class="md-nav__button md-logo" aria-label="OSG Networking Area" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    OSG Networking Area
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/osg-htc/networking/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSG Networking Area
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Network Monitoring (perfSONAR)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Network Monitoring (perfSONAR)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar-in-osg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Motivation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/deployment-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation and Maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Frequently Asked Questions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Network Troubleshooting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Network Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../network-troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../network-troubleshooting/osg-debugging-document/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSG Network Debugging Document
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Network Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Network Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/psetf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Infrastructure Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../osg-network-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Datastore and Streaming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../osg-network-analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Analytics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Personas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Personas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Quick Deploy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Quick Deploy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Landing
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Quickstart: perfSONAR Testpoint
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Quickstart: perfSONAR Testpoint
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites-and-planning" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites and Planning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-install-and-harden-el9" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1 – Install and Harden EL9
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2 – Clone the Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-configure-policy-based-routing-pbr" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3 – Configure Policy-Based Routing (PBR)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3 – Configure Policy-Based Routing (PBR)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns-forward-and-reverse-entries-required" class="md-nav__link">
    <span class="md-ellipsis">
      DNS: forward and reverse entries (required)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-configure-nftables-selinux-and-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4 – Configure nftables, SELinux, and Fail2Ban
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-deploy-the-containerized-perfsonar-testpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5 – Deploy the Containerized perfSONAR Testpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 5 – Deploy the Containerized perfSONAR Testpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-container-tooling-podman-and-optional-docker-style-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Install container tooling (Podman and optional Docker-style compose)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-directories-on-the-host" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare directories on the host
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seed-defaults-from-the-testpoint-container" class="md-nav__link">
    <span class="md-ellipsis">
      Seed defaults from the testpoint container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-baseline-content-out-of-the-running-container" class="md-nav__link">
    <span class="md-ellipsis">
      Copy baseline content out of the running container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-the-compose-file-with-bind-mounts-and-optional-certbot" class="md-nav__link">
    <span class="md-ellipsis">
      Replace the compose file with bind-mounts and optional certbot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-with-the-new-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Restart with the new compose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-obtain-your-first-lets-encrypt-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Optional – obtain your first Let’s Encrypt certificate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-register-and-configure-with-wlcgosg" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6 – Register and Configure with WLCG/OSG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6 – Register and Configure with WLCG/OSG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-lookup-service-registration-inside-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Update Lookup Service registration inside the container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automated-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automated setup
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Troubleshooter
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Landing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshoot/triage-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triage checklist
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Researcher
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Researcher
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/landing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Landing
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/fail2ban/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fail2ban
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/selinux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SELinux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/nftables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nftables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools & Scripts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tools & Scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scripts and tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/docker-compose.yml" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compose bundle (docker-compose.yml)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LS registration updater (script)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/perfSONAR-extract-lsregistration.sh" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LS registration extractor (script)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../perfsonar/tools_scripts/README-lsregistration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LS registration helpers (README)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Link-check tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites-and-planning" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites and Planning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-install-and-harden-el9" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1 – Install and Harden EL9
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-clone-the-repository" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2 – Clone the Repository
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-configure-policy-based-routing-pbr" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3 – Configure Policy-Based Routing (PBR)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3 – Configure Policy-Based Routing (PBR)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns-forward-and-reverse-entries-required" class="md-nav__link">
    <span class="md-ellipsis">
      DNS: forward and reverse entries (required)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-configure-nftables-selinux-and-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4 – Configure nftables, SELinux, and Fail2Ban
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-deploy-the-containerized-perfsonar-testpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5 – Deploy the Containerized perfSONAR Testpoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 5 – Deploy the Containerized perfSONAR Testpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-container-tooling-podman-and-optional-docker-style-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Install container tooling (Podman and optional Docker-style compose)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-directories-on-the-host" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare directories on the host
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seed-defaults-from-the-testpoint-container" class="md-nav__link">
    <span class="md-ellipsis">
      Seed defaults from the testpoint container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-baseline-content-out-of-the-running-container" class="md-nav__link">
    <span class="md-ellipsis">
      Copy baseline content out of the running container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-the-compose-file-with-bind-mounts-and-optional-certbot" class="md-nav__link">
    <span class="md-ellipsis">
      Replace the compose file with bind-mounts and optional certbot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-with-the-new-compose" class="md-nav__link">
    <span class="md-ellipsis">
      Restart with the new compose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-obtain-your-first-lets-encrypt-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Optional – obtain your first Let’s Encrypt certificate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-register-and-configure-with-wlcgosg" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6 – Register and Configure with WLCG/OSG
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6 – Register and Configure with WLCG/OSG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-lookup-service-registration-inside-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Update Lookup Service registration inside the container
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="installing-a-perfsonar-testpoint-for-wlcgosg">Installing a perfSONAR Testpoint for WLCG/OSG<a class="headerlink" href="#installing-a-perfsonar-testpoint-for-wlcgosg" title="Permanent link">&para;</a></h1>
<p>This quick-deploy playbook walks WLCG/OSG site administrators through the end-to-end installation, configuration, and validation of a perfSONAR testpoint on Enterprise Linux 9 (EL9). Each phase references tooling that already lives in this repository so you can automate as much as possible while still capturing the site-specific information required by OSG/WLCG operations.</p>
<hr />
<h2 id="prerequisites-and-planning">Prerequisites and Planning<a class="headerlink" href="#prerequisites-and-planning" title="Permanent link">&para;</a></h2>
<p>Before you begin, gather the following information:</p>
<ul>
<li><strong>Hardware details:</strong> hostname, BMC/iLO/iDRAC credentials (if used), interface names, available storage.</li>
<li><strong>Network data:</strong> IPv4/IPv6 assignments for each NIC, default gateway, internal/external VLAN information, PSConfig registration URLs.</li>
<li><strong>Operational contacts:</strong> site admin email, OSG facility name, latitude/longitude, usage policy link.</li>
<li>
<p><strong>Repository artifacts:</strong> the scripts referenced below are in <code>docs/perfsonar/</code> in this repository.</p>
</li>
<li>
<p><strong>Repository artifacts:</strong> the scripts referenced below are in <code>docs/perfsonar/</code> in this repository.</p>
</li>
<li>
<p><strong>Existing perfSONAR configuration:</strong> If you are replacing or upgrading an existing perfSONAR instance, capture its configuration and registration data before taking services offline. Useful items to collect include:</p>
<ul>
<li><code>/etc/perfsonar/</code> configuration files, especially <code>lsregistrationdaemon.conf</code></li>
<li>any site-specific psconfig or testpoint config files stored in container volumes or host paths</li>
<li>exported firewall, monitoring, and cron jobs that the current instance relies on</li>
</ul>
</li>
</ul>
<p>The repository includes a helper script <code>docs/perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh</code> which can copy and update <code>lsregistrationdaemon.conf</code> from running containers or the host; it can be used to extract registration config for re-use or migration. If you need to re-register or migrate metadata, run that script (or copy the <code>lsregistrationdaemon.conf</code> manually) and keep a copy in your change log.</p>
<p>Note: the full repository clone/checkout instructions have been moved to Step 2 (after Step 1) so you can perform the clone once the host is provisioned.</p>
<blockquote>
<p><strong>Note:</strong> All shell commands assume an interactive root shell. Prefix with <code>sudo</code> when running as a non-root user.</p>
</blockquote>
<hr />
<h2 id="step-1-install-and-harden-el9">Step 1 – Install and Harden EL9<a class="headerlink" href="#step-1-install-and-harden-el9" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Provision EL9:</strong> Install AlmaLinux, Rocky Linux, or RHEL 9 with the <em>Minimal</em> profile.</p>
</li>
<li>
<p><strong>Set the hostname and time sync:</strong></p>
<p>Note when you have multiple NICs pick one to be the hostname. That should also be the NIC that hosts the default route (See step 2 below).</p>
<details class="info">
<summary>System configuration commands</summary>
<div class="highlight"><pre><span></span><code>hostnamectl<span class="w"> </span>set-hostname<span class="w"> </span>&lt;testpoint-hostname&gt;
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>chronyd
timedatectl<span class="w"> </span>set-timezone<span class="w"> </span>&lt;Region/City&gt;
</code></pre></div>
</details>
</li>
<li>
<p><strong>Disable unused services:</strong></p>
<details class="info">
<summary>Service cleanup commands</summary>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>disable<span class="w"> </span>--now<span class="w"> </span>firewalld<span class="w"> </span>NetworkManager-wait-online
dnf<span class="w"> </span>remove<span class="w"> </span>-y<span class="w"> </span>rsyslog
</code></pre></div>
</details>
</li>
<li>
<p><strong>Record NIC names:</strong></p>
<details class="info">
<summary>Commands to list network interfaces</summary>
<div class="highlight"><pre><span></span><code>nmcli<span class="w"> </span>device<span class="w"> </span>status
ip<span class="w"> </span>-br<span class="w"> </span>addr
</code></pre></div>
<p>Document interface mappings; you will need them for the policy-based routing configuration.</p>
</details>
</li>
</ol>
<hr />
<h2 id="step-2-clone-the-repository">Step 2 – Clone the Repository<a class="headerlink" href="#step-2-clone-the-repository" title="Permanent link">&para;</a></h2>
<p>This guide references multiple scripts from the osg-htc/networking repository. Clone the repository to your testpoint host for easy access to all tools.</p>
<p><strong>Recommended locations:</strong></p>
<ul>
<li><strong>perfSONAR testpoint compose bundle:</strong> <code>/opt/perfsonar-tp</code> (if using containerized testpoint)</li>
</ul>
<p>Create the application directory for the testpoint bundle (no private clone required):</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/perfsonar-tp
</code></pre></div>
<p>We will then check out just the tools_scripts directory from this repo, to give us access to the appropriate scripts and tools.</p>
<p>Create only the perfSONAR tools directory from this repository using a sparse checkout, and place it under <code>/opt/perfsonar-tp/tools_scripts</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create destination directory</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/perfsonar-tp/tools_scripts

<span class="c1"># Use a temporary sparse checkout to fetch only docs/perfsonar/tools_scripts</span>
<span class="nv">tmpdir</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="w"> </span>-d<span class="k">)</span>
git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>--filter<span class="o">=</span>blob:none<span class="w"> </span>--sparse<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://github.com/osg-htc/networking.git<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpdir</span><span class="s2">/networking&quot;</span>

<span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpdir</span><span class="s2">/networking&quot;</span>
git<span class="w"> </span>sparse-checkout<span class="w"> </span><span class="nb">set</span><span class="w"> </span>docs/perfsonar/tools_scripts

<span class="c1"># Copy the tools into /opt/perfsonar-tp/tools_scripts</span>
rsync<span class="w"> </span>-a<span class="w"> </span>docs/perfsonar/tools_scripts/<span class="w"> </span>/opt/perfsonar-tp/tools_scripts/

<span class="c1"># Optional: list what was installed</span>
ls<span class="w"> </span>-1<span class="w"> </span>/opt/perfsonar-tp/tools_scripts

<span class="c1"># Cleanup</span>
<span class="nb">cd</span><span class="w"> </span>/
rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmpdir</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Notes:
- The source path in this repo is <code>docs/perfsonar/tools_scripts</code> (plural). We install it to <code>/opt/perfsonar-tp/tools_scripts</code> to keep the same name.
- You don’t need to keep a full clone of the networking repo on the host for these tools; the sparse checkout above fetches only the needed directory.</p>
<p>After cloning, all script examples in this guide that reference <code>docs/perfsonar/tools_scripts/</code> assume you're running commands from <code>/opt/networking</code>.</p>
<blockquote>
<p><strong>Note:</strong> All shell commands assume an interactive root shell. Prefix with <code>sudo</code> when running as a non-root user.</p>
</blockquote>
<hr />
<ol>
<li>
<p><strong>Apply baseline updates (and verify dependencies):</strong></p>
<p>Use the repository's helper to check for required tools and print
copy/paste install commands. Then apply OS updates and any remaining
baseline packages.</p>
<ul>
<li>
<p>From a local clone of this repository (recommended):</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt/networking
./docs/perfsonar/tools_scripts/check-deps.sh
</code></pre></div>
</li>
</ul>
<details class="tip">
<summary>Alternative: Download and run directly</summary>
<div class="highlight"><pre><span></span><code><span class="w">        </span>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">            </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/check-deps.sh<span class="w"> </span><span class="se">\</span>
<span class="w">            </span>-o<span class="w"> </span>./check-deps.sh
chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>./check-deps.sh
./check-deps.sh
</code></pre></div>
</details>
<details class="info">
<summary>Apply updates and install baseline packages</summary>
<p>On EL9, apply updates and install common baseline packages, then add any
packages suggested by the checker (copy/paste the printed dnf line):</p>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>update<span class="w"> </span>-y
dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>epel-release<span class="w"> </span>chrony<span class="w"> </span>vim<span class="w"> </span>git
<span class="c1"># (Optional) install any additional packages suggested by check-deps.sh</span>
<span class="c1"># e.g., dnf install -y NetworkManager rsync curl openssl nftables</span>
</code></pre></div>
</details>
</li>
</ol>
<h2 id="step-3-configure-policy-based-routing-pbr">Step 3 – Configure Policy-Based Routing (PBR)<a class="headerlink" href="#step-3-configure-policy-based-routing-pbr" title="Permanent link">&para;</a></h2>
<p>The repository ships an enhanced script <code>docs/perfsonar/tools_scripts/perfSONAR-pbr-nm.sh</code> that automates NetworkManager configuration and routing rules and can auto-generate its config file.</p>
<p>Script location in the repository:</p>
<ul>
<li><a href="https://github.com/osg-htc/networking/tree/master/docs/perfsonar/tools_scripts">Directory (browse)</a></li>
<li>
<p><a href="https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/perfSONAR-pbr-nm.sh">Raw file (direct download)</a></p>
</li>
<li>
<p><strong>Stage the script:</strong></p>
<ul>
<li>
<p>From a local clone of this repository:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt/networking
install<span class="w"> </span>-m<span class="w"> </span><span class="m">0755</span><span class="w"> </span>docs/perfsonar/tools_scripts/perfSONAR-pbr-nm.sh<span class="w"> </span>~/perfsonar-pbr-nm.sh
<span class="nb">cd</span><span class="w"> </span>~
</code></pre></div>
</li>
</ul>
<details class="tip">
<summary>Alternative: Download directly from the repository URL</summary>
<div class="highlight"><pre><span></span><code><span class="w">        </span>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">            </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/perfSONAR-pbr-nm.sh<span class="w"> </span><span class="se">\</span>
<span class="w">            </span>-o<span class="w"> </span>./perfSONAR-pbr-nm.sh
chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>./perfSONAR-pbr-nm.sh
</code></pre></div>
</details>
</li>
<li>
<p><strong>Auto-generate <code>/etc/perfSONAR-multi-nic-config.conf</code>:</strong> use the script’s generator to detect NICs, addresses, prefixes, and gateways and write a starting config you can review/edit. Auto-generation is opt-in; it does not run by default.</p>
<ul>
<li>
<p>Preview (no changes):</p>
<div class="highlight"><pre><span></span><code>~/perfsonar-pbr-nm.sh<span class="w"> </span>--generate-config-debug
</code></pre></div>
</li>
<li>
<p>Write the config file to <code>/etc/perfSONAR-multi-nic-config.conf</code>:</p>
<div class="highlight"><pre><span></span><code>~/perfsonar-pbr-nm.sh<span class="w"> </span>--generate-config-auto
</code></pre></div>
</li>
</ul>
<p>Then open the file and adjust any site-specific values (e.g., confirm <code>DEFAULT_ROUTE_NIC</code>, add any <code>NIC_IPV4_ADDROUTE</code> entries, or replace “-” for unused IP/gateway fields).</p>
<div class="admonition warning">
<p class="admonition-title">Gateways required for addresses</p>
<p>Any NIC with an IPv4 address must also have an IPv4 gateway, and any NIC with an IPv6 address must have an IPv6 gateway. If the generator cannot detect a gateway, it adds a WARNING block to the generated file listing affected NICs. Edit <code>NIC_IPV4_GWS</code>/<code>NIC_IPV6_GWS</code> accordingly before applying changes.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Gateway prompts</p>
<p>During generation, the script attempts to detect gateways per-NIC. If a NIC has an IP address but no gateway could be determined, it will prompt you interactively to enter an IPv4 and/or IPv6 gateway (or <code>-</code> to skip). Prompts are skipped in non-interactive sessions or when you use <code>--yes</code>.</p>
</div>
</li>
<li>
<p><strong>Execute the script:</strong></p>
<ul>
<li>
<p>Rehearsal (no changes, extra logging recommended on first run):</p>
<div class="highlight"><pre><span></span><code>~/perfsonar-pbr-nm.sh<span class="w"> </span>--dry-run<span class="w"> </span>--debug
</code></pre></div>
</li>
<li>
<p>Apply changes non-interactively (auto-confirm):</p>
<div class="highlight"><pre><span></span><code>~/perfsonar-pbr-nm.sh<span class="w"> </span>--yes
</code></pre></div>
</li>
<li>
<p>Or run interactively and answer the confirmation prompt when ready:</p>
<div class="highlight"><pre><span></span><code>~/perfsonar-pbr-nm.sh
</code></pre></div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Missing gateways at apply time</p>
<p>If the loaded config still contains <code>-</code> for a gateway on a NIC that has an IP address, the script will prompt you interactively to provide a gateway before applying changes. Use <code>--yes</code> (or run non-interactively) to suppress prompts; in that case, missing gateways will cause validation to fail so you can correct the config first.</p>
</div>
<p>The script creates a timestamped backup of existing NetworkManager profiles, seeds routing tables, and applies routing rules. Review <code>/var/log/perfSONAR-multi-nic-config.log</code> after the run and retain it with your change records.</p>
</li>
</ul>
<h3 id="dns-forward-and-reverse-entries-required">DNS: forward and reverse entries (required)<a class="headerlink" href="#dns-forward-and-reverse-entries-required" title="Permanent link">&para;</a></h3>
<p>All IP addresses that will be used for perfSONAR testing MUST have DNS entries: a forward (A/AAAA) record and a matching reverse (PTR) record. This is required so remote test tools and site operators can reliably reach and identify your host, and because some measurement infrastructure and registration systems perform forward/reverse consistency checks.</p>
<ul>
<li>For single-stack IPv4-only hosts: ensure A and PTR are present and consistent.</li>
<li>For single-stack IPv6-only hosts: ensure AAAA and PTR are present and consistent.</li>
<li>For dual-stack hosts: both IPv4 and IPv6 addresses used for testing must have matching forward and reverse records (A+PTR and AAAA+PTR).</li>
</ul>
<details class="example">
<summary>Example: Bash script to automate DNS verification</summary>
<p>The <code>perfSONAR-multi-nic-config.conf</code> contains the arrays <code>NIC_IPV4_ADDRS</code> and <code>NIC_IPV6_ADDRS</code> (with <code>-</code> for unused entries). You can automate a forward/reverse consistency check using <code>dig</code> or <code>host</code> by sourcing the config and iterating the arrays.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># quick DNS consistency check using /etc/perfSONAR-multi-nic-config.conf</span>
<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail
<span class="nv">CONFIG</span><span class="o">=</span>/etc/perfSONAR-multi-nic-config.conf
<span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Config not found: </span><span class="nv">$CONFIG</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG</span><span class="s2">&quot;</span>

check_ip<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">   </span><span class="nb">local</span><span class="w"> </span><span class="nv">ip</span><span class="o">=</span><span class="nv">$1</span>
<span class="w">   </span><span class="nb">local</span><span class="w"> </span><span class="nv">family</span><span class="o">=</span><span class="nv">$2</span><span class="w">   </span><span class="c1"># 4 or 6</span>
<span class="w">   </span><span class="c1"># strip CIDR if present</span>
<span class="w">   </span><span class="nv">ip</span><span class="o">=</span><span class="si">${</span><span class="nv">ip</span><span class="p">%%/*</span><span class="si">}</span>
<span class="w">   </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>

<span class="w">   </span><span class="c1"># PTR lookup (reverse)</span>
<span class="w">   </span><span class="nv">ptr</span><span class="o">=</span><span class="k">$(</span>dig<span class="w"> </span>+short<span class="w"> </span>-x<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n1<span class="k">)</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ptr</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MISSING PTR for </span><span class="nv">$ip</span><span class="s2">&quot;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">   </span><span class="k">fi</span>
<span class="w">   </span><span class="c1"># remove trailing dot from PTR</span>
<span class="w">   </span><span class="nv">ptr</span><span class="o">=</span><span class="si">${</span><span class="nv">ptr</span><span class="p">%.</span><span class="si">}</span>

<span class="w">   </span><span class="c1"># Forward lookup for the hostname returned by PTR</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$family</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;4&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nv">fwd</span><span class="o">=</span><span class="k">$(</span>dig<span class="w"> </span>+short<span class="w"> </span>A<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ptr</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<span class="w">   </span><span class="k">else</span>
<span class="w">  </span><span class="nv">fwd</span><span class="o">=</span><span class="k">$(</span>dig<span class="w"> </span>+short<span class="w"> </span>AAAA<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ptr</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<span class="w">   </span><span class="k">fi</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fwd</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-qw<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;INCONSISTENT: PTR </span><span class="nv">$ptr</span><span class="s2"> does not resolve back to </span><span class="nv">$ip</span><span class="s2"> (resolved: </span><span class="nv">$fwd</span><span class="s2">)&quot;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">   </span><span class="k">fi</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;OK: </span><span class="nv">$ip</span><span class="s2"> ⇄ </span><span class="nv">$ptr</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="o">}</span>

<span class="nv">errors</span><span class="o">=</span><span class="m">0</span>
<span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NIC_IPV4_ADDRS</span><span class="p">[@]</span><span class="k">:-</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>check_ip<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">errors</span><span class="o">=</span><span class="k">$((</span><span class="nv">errors</span><span class="o">+</span><span class="m">1</span><span class="k">))</span>
<span class="w">   </span><span class="k">fi</span>
<span class="k">done</span>
<span class="k">for</span><span class="w"> </span>ip<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NIC_IPV6_ADDRS</span><span class="p">[@]</span><span class="k">:-</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>check_ip<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ip</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">errors</span><span class="o">=</span><span class="k">$((</span><span class="nv">errors</span><span class="o">+</span><span class="m">1</span><span class="k">))</span>
<span class="w">   </span><span class="k">fi</span>
<span class="k">done</span>

<span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>errors<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;DNS verification failed (</span><span class="nv">$errors</span><span class="s2"> problem(s)). Fix DNS (forward/reverse) before running tests.&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="w">   </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;DNS forward/reverse checks passed for configured addresses.&quot;</span>
</code></pre></div>
<p><strong>Notes and automation tips:</strong></p>
<ul>
<li>The script above uses <code>dig</code> (bind-utils package) which is commonly available; you can adapt it to use <code>host</code> if preferred.</li>
<li>Run the check as part of your provisioning CI or as a pre-flight check before enabling measurement registration.</li>
<li>For large sites or many addresses, parallelize the checks (xargs -P) or use a small Python script that leverages <code>dns.resolver</code> for async checks.</li>
<li>If your PTR returns a hostname with a trailing dot, the script strips it before the forward check.</li>
</ul>
</details>
<p>If any addresses fail these checks, correct the DNS zone (forward and/or reverse) and allow DNS propagation before proceeding with registration and testing.</p>
<details class="example">
<summary>Download and run the DNS checker</summary>
<p>You can download and run the DNS checker directly on the host (or from any machine that has network visibility to your DNS servers). The script expects <code>/etc/perfSONAR-multi-nic-config.conf</code> to exist and be readable.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Download (curl)</span>
<span class="w">    </span>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/check-perfsonar-dns.sh<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-o<span class="w"> </span>./check-perfsonar-dns.sh
<span class="c1"># Or download with wget</span>
<span class="c1"># wget -O ./check-perfsonar-dns.sh https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/check-perfsonar-dns.sh</span>

chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>./check-perfsonar-dns.sh

<span class="c1"># Install DNS tools if missing (EL9)</span>
sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>bind-utils

<span class="c1"># Debian/Ubuntu alternative</span>
<span class="c1"># sudo apt-get update &amp;&amp; sudo apt-get install -y dnsutils</span>

<span class="c1"># Run the check (needs to read /etc/perfSONAR-multi-nic-config.conf)</span>
sudo<span class="w"> </span>./check-perfsonar-dns.sh
</code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>If you downloaded the script to a different path, either move it to the host and run it there, or copy <code>/etc/perfSONAR-multi-nic-config.conf</code> to the machine where you run the check (recommended only for temporary verification; treat the config as sensitive).</li>
<li>The script uses <code>dig</code> (preferred) or <code>host</code> as a fallback; ensure one of those is installed.</li>
<li>Run this check after you generate or edit <code>/etc/perfSONAR-multi-nic-config.conf</code> and before you register or start active measurements.</li>
</ul>
</details>
<ol>
<li><strong>Verify the routing policy:</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>nmcli<span class="w"> </span>connection<span class="w"> </span>show
ip<span class="w"> </span>rule<span class="w"> </span>show
ip<span class="w"> </span>route<span class="w"> </span>show<span class="w"> </span>table<span class="w"> </span>&lt;table-id&gt;
</code></pre></div>
<p>Confirm that non-default interfaces have their own routing tables and that the default interface owns the system default route.</p>
<hr />
<h2 id="step-4-configure-nftables-selinux-and-fail2ban">Step 4 – Configure nftables, SELinux, and Fail2Ban<a class="headerlink" href="#step-4-configure-nftables-selinux-and-fail2ban" title="Permanent link">&para;</a></h2>
<p>Use <code>docs/perfsonar/tools_scripts/perfSONAR-install-nftables.sh</code> to configure a hardened nftables profile with optional SELinux and Fail2Ban support.</p>
<p>Script location in the repository:</p>
<ul>
<li><a href="https://github.com/osg-htc/networking/tree/master/docs/perfsonar/tools_scripts">Directory (browse)</a></li>
<li><a href="https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/perfSONAR-install-nftables.sh">Raw file (direct download)</a></li>
</ul>
<p>Prerequisites (not installed by the script):</p>
<ul>
<li><code>nftables</code> must already be installed and available (<code>nft</code> binary) for firewall configuration.</li>
<li><code>fail2ban</code> must be installed if you want the optional jail configuration.</li>
<li>SELinux tools (e.g., <code>getenforce</code>, <code>policycoreutils</code>) must be present to attempt SELinux configuration.</li>
</ul>
<p>If any prerequisite is missing, the script skips that component and continues.</p>
<ol>
<li>
<p><strong>Stage the installer:</strong></p>
<ul>
<li>
<p>From a local clone of this repository:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt/networking
install<span class="w"> </span>-m<span class="w"> </span><span class="m">0755</span><span class="w"> </span>docs/perfsonar/tools_scripts/perfSONAR-install-nftables.sh<span class="w"> </span>~/perfsonar-install-nftables.sh
<span class="nb">cd</span><span class="w"> </span>~
</code></pre></div>
</li>
</ul>
<details class="tip">
<summary>Alternative: Download directly from the repository URL</summary>
<div class="highlight"><pre><span></span><code><span class="w">        </span>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">            </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/perfSONAR-install-nftables.sh<span class="w"> </span><span class="se">\</span>
<span class="w">            </span>-o<span class="w"> </span>~/perfsonar-install-nftables.sh
chmod<span class="w"> </span><span class="m">0755</span><span class="w"> </span>~/perfsonar-install-nftables.sh
</code></pre></div>
</details>
<ol>
<li><strong>Run with desired options:</strong></li>
</ol>
<div class="highlight"><pre><span></span><code>~/perfsonar-install-nftables.sh<span class="w"> </span>--selinux<span class="w"> </span>--fail2ban<span class="w"> </span>--yes
</code></pre></div>
<ul>
<li>Use <code>--yes</code> to skip the interactive confirmation prompt (omit it if you prefer to review the summary and answer manually).</li>
<li>Add <code>--dry-run</code> for a rehearsal that only prints the planned actions.</li>
</ul>
<p>The script writes nftables rules for perfSONAR services, derives SSH allow-lists from <code>/etc/perfSONAR-multi-nic-config.conf</code>, optionally adjusts SELinux, and enables Fail2Ban jails—only if those components are already installed.</p>
</li>
</ol>
<details class="info">
<summary>How SSH allow-lists and validation work</summary>
<p><strong>SSH allow-list derivation:</strong></p>
<ul>
<li>CIDR values in <code>NIC_IPV4_PREFIXES</code>/<code>NIC_IPV6_PREFIXES</code> paired with corresponding addresses are treated as subnets.</li>
<li>Address entries without a prefix are treated as single hosts.</li>
<li>The script logs the resolved lists (IPv4/IPv6 subnets and hosts) for review.</li>
</ul>
<p><strong>Validation and output:</strong></p>
<ul>
<li>The generated nftables file is validated with <code>nft -c -f</code> before being written; on validation failure, nothing is installed and a message is logged.</li>
<li>Output locations: rules → <code>/etc/nftables.d/perfsonar.nft</code>, log → <code>/var/log/perfSONAR-install-nftables.log</code>, backups → <code>/var/backups/perfsonar-install-&lt;timestamp&gt;</code>.</li>
</ul>
<details class="tip">
<summary>Preview nftables rules before applying</summary>
<p>You can preview the fully rendered nftables rules (no changes are made):</p>
<div class="highlight"><pre><span></span><code>~/perfsonar-install-nftables.sh<span class="w"> </span>--print-rules
</code></pre></div>
</details>
</details>
<details class="tip">
<summary>Manually add extra management hosts/subnets</summary>
<p>If you need to allow additional SSH sources not represented by your NIC-derived prefixes, edit <code>/etc/nftables.d/perfsonar.nft</code> and add entries to the appropriate sets:</p>
<div class="highlight"><pre><span></span><code>set ssh_access_ip4_subnets {
type ipv4_addr
flags interval
elements = { 192.0.2.0/24, 198.51.100.0/25 }
}

set ssh_access_ip4_hosts {
type ipv4_addr
elements = { 203.0.113.10, 203.0.113.11 }
}

set ssh_access_ip6_subnets {
type ipv6_addr
flags interval
elements = { 2001:db8:1::/64 }
}

set ssh_access_ip6_hosts {
type ipv6_addr
elements = { 2001:db8::10 }
}
</code></pre></div>
<p>Then validate and reload (root shell):</p>
<div class="highlight"><pre><span></span><code>nft<span class="w"> </span>-c<span class="w"> </span>-f<span class="w"> </span>/etc/nftables.d/perfsonar.nft
systemctl<span class="w"> </span>reload<span class="w"> </span>nftables<span class="w"> </span><span class="o">||</span><span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nftables
</code></pre></div>
<ol>
<li><strong>Confirm firewall state and security services:</strong></li>
</ol>
<details class="info">
<summary>Verification commands</summary>
<div class="highlight"><pre><span></span><code>nft<span class="w"> </span>list<span class="w"> </span>ruleset
sestatus
systemctl<span class="w"> </span>status<span class="w"> </span>fail2ban
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Document any site-specific exceptions (e.g., additional allowed management hosts) in your change log.

---
</code></pre></div>

</details>
</details>
<h2 id="step-5-deploy-the-containerized-perfsonar-testpoint">Step 5 – Deploy the Containerized perfSONAR Testpoint<a class="headerlink" href="#step-5-deploy-the-containerized-perfsonar-testpoint" title="Permanent link">&para;</a></h2>
<p>We’ll run the official testpoint image from the GitHub Container Registry using Podman, but we’ll show Docker-style commands so you can choose either tool. We’ll bind-mount host paths so edits on the host are reflected inside the containers.</p>
<p>Key paths to persist on the host:</p>
<ul>
<li><code>/opt/perfsonar-tp/psconfig</code> → container <code>/etc/perfsonar/psconfig</code></li>
<li><code>/etc/apache2</code> → container <code>/etc/apache2</code> (Apache configs)</li>
<li><code>/var/www/html</code> → container <code>/var/www/html</code> (webroot for Toolkit and ACME challenges)</li>
<li><code>/etc/letsencrypt</code> → container <code>/etc/letsencrypt</code> (certs/keys, if using Let’s Encrypt)</li>
</ul>
<h3 id="install-container-tooling-podman-and-optional-docker-style-compose">Install container tooling (Podman and optional Docker-style compose)<a class="headerlink" href="#install-container-tooling-podman-and-optional-docker-style-compose" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>podman<span class="w"> </span>podman-compose<span class="w"> </span>python3-pip
pip3<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>docker-compose
</code></pre></div>
<p>Tip: you can use either <code>podman-compose</code> or <code>docker-compose</code> in the steps below. Substitute the command that matches your preference.</p>
<h3 id="prepare-directories-on-the-host">Prepare directories on the host<a class="headerlink" href="#prepare-directories-on-the-host" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/perfsonar-tp/psconfig
mkdir<span class="w"> </span>-p<span class="w"> </span>/var/www/html
mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/apache2
mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/letsencrypt
</code></pre></div>
<h3 id="seed-defaults-from-the-testpoint-container">Seed defaults from the testpoint container<a class="headerlink" href="#seed-defaults-from-the-testpoint-container" title="Permanent link">&para;</a></h3>
<p>First, create a minimal compose file and start the container without host bind-mounts so we can copy baseline content out.</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.9&quot;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">testpoint</span><span class="p">:</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">perfsonar-testpoint</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/perfsonar/testpoint:5.2.4-systemd</span>
<span class="w">        </span><span class="nt">network_mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span>
<span class="w">        </span><span class="nt">cgroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=UTC</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">        </span><span class="nt">tmpfs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run/lock</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys/fs/cgroup:/sys/fs/cgroup:rw</span>
<span class="w">        </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">pids_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8192</span>
<span class="w">        </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CAP_NET_RAW</span>
</code></pre></div>
<p>Bring it up with your preferred tool:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="nb">cd</span><span class="w"> </span>/opt/perfsonar-tp<span class="p">;</span><span class="w"> </span>podman-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="o">)</span><span class="w">  </span><span class="c1"># or: (cd /opt/perfsonar-tp; docker-compose up -d)</span>
</code></pre></div>
<h3 id="copy-baseline-content-out-of-the-running-container">Copy baseline content out of the running container<a class="headerlink" href="#copy-baseline-content-out-of-the-running-container" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Use docker cp or podman cp (either works)</span>
docker<span class="w"> </span>cp<span class="w"> </span>perfsonar-testpoint:/etc/apache2<span class="w"> </span>/etc/apache2
docker<span class="w"> </span>cp<span class="w"> </span>perfsonar-testpoint:/var/www/html<span class="w"> </span>/var/www/html
docker<span class="w"> </span>cp<span class="w"> </span>perfsonar-testpoint:/etc/perfsonar/psconfig<span class="w"> </span>/opt/perfsonar-tp/psconfig
</code></pre></div>
<p>If SELinux is enforcing, we’ll relabel these paths when we mount (using <code>:z</code>/<code>:Z</code> below), so you don’t need manual <code>chcon</code>.</p>
<h3 id="replace-the-compose-file-with-bind-mounts-and-optional-certbot">Replace the compose file with bind-mounts and optional certbot<a class="headerlink" href="#replace-the-compose-file-with-bind-mounts-and-optional-certbot" title="Permanent link">&para;</a></h3>
<p>You can download a ready-to-use compose file from this repository, or create it manually.</p>
<ul>
<li><a href="https://github.com/osg-htc/networking/tree/master/docs/perfsonar/tools_scripts/docker-compose.yml">Browse</a></li>
<li>Download directly:</li>
</ul>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/docker-compose.yml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>/opt/perfsonar-tp/docker-compose.yml
</code></pre></div>
<p>Or create/edit <code>/opt/perfsonar-tp/docker-compose.yml</code> with the following content (includes an optional <code>certbot</code> sidecar):</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.9&quot;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">testpoint</span><span class="p">:</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">perfsonar-testpoint</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/perfsonar/testpoint:5.2.4-systemd</span>
<span class="w">        </span><span class="nt">network_mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span>
<span class="w">        </span><span class="nt">cgroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">        </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=UTC</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">        </span><span class="nt">tmpfs</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run/lock</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys/fs/cgroup:/sys/fs/cgroup:rw</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt/perfsonar-tp/psconfig:/etc/perfsonar/psconfig:Z</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html:/var/www/html:z</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/apache2:/etc/apache2:z</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/letsencrypt:/etc/letsencrypt:z</span>
<span class="w">        </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">pids_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8192</span>
<span class="w">        </span><span class="nt">cap_add</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CAP_NET_RAW</span>

<span class="w">    </span><span class="c1"># Optional: Let’s Encrypt renewer sharing HTML and certs with testpoint</span>
<span class="w">    </span><span class="nt">certbot</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">certbot/certbot</span>
<span class="w">        </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">certbot</span>
<span class="w">        </span><span class="nt">network_mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span>
<span class="w">        </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">        </span><span class="nt">entrypoint</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;trap</span><span class="nv"> </span><span class="s">exit</span><span class="nv"> </span><span class="s">TERM;</span><span class="nv"> </span><span class="s">while</span><span class="nv"> </span><span class="s">:;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">certbot</span><span class="nv"> </span><span class="s">renew;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">12h</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">wait</span><span class="nv"> </span><span class="s">$${!};</span><span class="nv"> </span><span class="s">done;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testpoint</span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html:/var/www/html:z</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/letsencrypt:/etc/letsencrypt:z</span>
</code></pre></div>
<h3 id="restart-with-the-new-compose">Restart with the new compose<a class="headerlink" href="#restart-with-the-new-compose" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">(</span><span class="nb">cd</span><span class="w"> </span>/opt/perfsonar-tp<span class="p">;</span><span class="w"> </span>podman-compose<span class="w"> </span>down<span class="o">)</span>
<span class="o">(</span><span class="nb">cd</span><span class="w"> </span>/opt/perfsonar-tp<span class="p">;</span><span class="w"> </span>podman-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="o">)</span><span class="w">  </span><span class="c1"># or docker-compose down &amp;&amp; docker-compose up -d</span>
</code></pre></div>
<h3 id="optional-obtain-your-first-lets-encrypt-certificate">Optional – obtain your first Let’s Encrypt certificate<a class="headerlink" href="#optional-obtain-your-first-lets-encrypt-certificate" title="Permanent link">&para;</a></h3>
<p>The <code>certbot</code> sidecar above continuously renews existing certs. For the initial issuance, run a one-shot command and then reload Apache inside the testpoint container:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Issue (HTTP-01 webroot challenge). Replace values accordingly.</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--net<span class="o">=</span>host<span class="w"> </span>-v<span class="w"> </span>/var/www/html:/var/www/html<span class="w"> </span>-v<span class="w"> </span>/etc/letsencrypt:/etc/letsencrypt<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>certbot/certbot<span class="w"> </span>certonly<span class="w"> </span>--webroot<span class="w"> </span>-w<span class="w"> </span>/var/www/html<span class="w"> </span>-d<span class="w"> </span>&lt;SERVER_FQDN&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--email<span class="w"> </span>&lt;LETSENCRYPT_EMAIL&gt;<span class="w"> </span>--agree-tos<span class="w"> </span>--no-eff-email

<span class="c1"># Gracefully reload Apache within the testpoint container (or restart the service)</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>perfsonar-testpoint<span class="w"> </span>bash<span class="w"> </span>-lc<span class="w"> </span><span class="s1">&#39;systemctl reload httpd || apachectl -k graceful || true&#39;</span>
</code></pre></div>
<details class="info">
<summary>Notes</summary>
<ul>
<li>Ensure port 80 on the host is reachable from the internet while issuing certificates.</li>
<li>All shared paths use SELinux-aware <code>:z</code>/<code>:Z</code> to permit container access on enforcing hosts.</li>
</ul>
</details>
<h2 id="step-6-register-and-configure-with-wlcgosg">Step 6 – Register and Configure with WLCG/OSG<a class="headerlink" href="#step-6-register-and-configure-with-wlcgosg" title="Permanent link">&para;</a></h2>
<p>We need to register your instance and ensure it is configurated with the required meta data for the lsregistration daemon (see below).</p>
<details class="info">
<summary>Configuration details to populate</summary>
<ul>
<li>Site contact email</li>
<li>Usage policy URL</li>
<li>Location (latitude/longitude)</li>
<li>Export the configuration via <code>/etc/perfsonar/psconfig/nodes/local.json</code> for record keeping</li>
</ul>
</details>
<ol>
<li>
<p><strong>OSG/WLCG registration workflow:</strong></p>
<details class="info">
<summary>Registration steps and portals</summary>
<ul>
<li>Register the host in <a href="https://topology.opensciencegrid.org/host">OSG topology</a>.</li>
<li>Create or update a <a href="https://ggus.eu/">GGUS</a> ticket announcing the new measurement point.</li>
<li>In <a href="https://goc.egi.eu/portal/">GOCDB</a>, add the service endpoint <code>org.opensciencegrid.crc.perfsonar-testpoint</code> bound to this host.</li>
</ul>
</details>
</li>
<li>
<p><strong>pSConfig enrollment:</strong></p>
</li>
</ol>
<p>For each active NIC, register with the psconfig service so measurements cover all paths.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">???</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="s2">&quot;Registration command and verification&quot;</span>
<span class="n">Example</span><span class="w"> </span><span class="k">registration</span><span class="o">:</span>

<span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">bash</span>
<span class="n n-Quoted">/usr/bin/psconfig psconfig remote --configure-archives add --url https://psconfig.opensciencegrid.org/pub/auto/&lt;NIC-FQDN&gt;</span>
<span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span>

<span class="n">Confirm</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">resulting</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n n-Quoted">`/etc/perfsonar/psconfig/pscheduler.d/`</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">addresses</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`ifaddr`</span><span class="w"> </span><span class="n">tags</span><span class="p">).</span>

<span class="mf">1.</span><span class="w"> </span><span class="o">**</span><span class="n">Document</span><span class="w"> </span><span class="n">memberships</span><span class="o">:**</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">site</span><span class="w"> </span><span class="n">wiki</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">change</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">assigned</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="k">names</span><span class="p">,</span><span class="w"> </span><span class="n">feed</span><span class="w"> </span><span class="n">URLs</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">contacts</span><span class="p">.</span>
</code></pre></div>

<h3 id="update-lookup-service-registration-inside-the-container">Update Lookup Service registration inside the container<a class="headerlink" href="#update-lookup-service-registration-inside-the-container" title="Permanent link">&para;</a></h3>
<p>Use the helper script to edit <code>/etc/perfsonar/lsregistrationdaemon.conf</code> inside the running <code>perfsonar-testpoint</code> container and restart the daemon only if needed.</p>
<ul>
<li>Script (browse): <a href="https://github.com/osg-htc/networking/tree/master/docs/perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh">perfSONAR-update-lsregistration.sh</a></li>
<li>Raw (download): <a href="https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh">raw link</a></li>
</ul>
<p>Install and run examples (root shell):</p>
<p>```
curl -fsSL https://raw.githubusercontent.com/osg-htc/networking/master/docs/perfsonar/tools_scripts/perfSONAR-update-lsregistration.sh \
   -o ~/perfSONAR-update-lsregistration.sh
chmod 0755 ~/perfSONAR-update-lsregistration.sh</p>
<h1 id="preview-changes-only">Preview changes only<a class="headerlink" href="#preview-changes-only" title="Permanent link">&para;</a></h1>
<p>~/perfSONAR-update-lsregistration.sh --dry-run --site-name "Acme Co." --project WLCG --admin-email admin@example.org --admin-name "pS Admin"</p>
<h1 id="apply-common-updates-and-restart-the-daemon-inside-the-container">Apply common updates and restart the daemon inside the container<a class="headerlink" href="#apply-common-updates-and-restart-the-daemon-inside-the-container" title="Permanent link">&para;</a></h1>
<p>~/perfSONAR-update-lsregistration.sh \
   --site-name "Acme Co." --domain example.org --project WLCG --project OSG \
   --city Berkeley --region CA --country US --zip 94720 \
   --latitude 37.5 --longitude -121.7469 \
   --admin-name "pS Admin" --admin-email admin@example.org</p>
<p>```bash</p>
<hr />
<h2 id="step-7-post-install-validation">Step 7 – Post-Install Validation<a class="headerlink" href="#step-7-post-install-validation" title="Permanent link">&para;</a></h2>
<p>Perform these checks before handing the host over to operations:</p>
<ol>
<li>
<p><strong>System services:</strong></p>
<details class="info">
<summary>Verify Podman and compose services</summary>
<p><code>bash
systemctl status podman
systemctl --user status podman-compose@perfsonar-testpoint.service</code></p>
<p>Ensure both are active/green.</p>
</details>
</li>
<li>
<p><strong>Container health:</strong></p>
<details class="info">
<summary>Check container status and logs</summary>
<p><code>bash
podman ps --format 'table {{.Names}}\t{{.Status}}\t{{.Ports}}'
podman logs pscheduler-agent | tail</code></p>
</details>
</li>
<li>
<p><strong>Network path validation:</strong></p>
<details class="info">
<summary>Test network connectivity and routing</summary>
<p><code>bash
pscheduler task throughput --dest &lt;remote-testpoint&gt;
tracepath -n &lt;remote-testpoint&gt;</code></p>
<p>Confirm traffic uses the intended policy-based routes (check <code>ip route get &lt;dest&gt;</code>).</p>
</details>
</li>
<li>
<p><strong>Toolkit diagnostics:</strong> visit the Toolkit UI → <em>Dashboard</em> → <em>Host Status</em> to confirm pScheduler, MaDDash, and owamp/bwctl services report healthy.</p>
</li>
<li>
<p><strong>Security posture:</strong></p>
<details class="info">
<summary>Check firewall, fail2ban, and SELinux</summary>
<p><code>bash
nft list ruleset | grep perfsonar
fail2ban-client status
ausearch --message AVC --just-one</code></p>
<p>Investigate any SELinux denials or repeated Fail2Ban bans.</p>
</details>
</li>
<li>
<p><strong>LetsEncrypt certificate check:</strong></p>
<details class="info">
<summary>Verify certificate validity</summary>
<p><code>bash
openssl s_client -connect &lt;SERVER_FQDN&gt;:443 -servername &lt;SERVER_FQDN&gt; | openssl x509 -noout -dates -issuer</code></p>
<p>Ensure the issuer is Let’s Encrypt and the validity period is acceptable.</p>
</details>
</li>
<li>
<p><strong>Reporting:</strong></p>
<details class="info">
<summary>Run perfSONAR diagnostic reports</summary>
<p>Run the perfSONAR toolkit daily report and send outputs to operations:</p>
<p><code>bash
pscheduler troubleshoot
toolkit-system-health</code></p>
<hr />
</details>
</li>
</ol>
<h2 id="ongoing-maintenance">Ongoing Maintenance<a class="headerlink" href="#ongoing-maintenance" title="Permanent link">&para;</a></h2>
<ul>
<li>Schedule quarterly re-validation of routing policy and nftables rules.</li>
<li>Apply <code>dnf update</code> monthly and reboot during the next maintenance window.</li>
<li>Monitor psconfig feeds for changes in mesh participation.</li>
<li>Track certificate expiry (<code>certbot renew --dry-run</code>) if you rely on Let’s Encrypt.</li>
</ul>
<h3 id="automatic-image-updates-and-safe-restarts">Automatic image updates and safe restarts<a class="headerlink" href="#automatic-image-updates-and-safe-restarts" title="Permanent link">&para;</a></h3>
<p>Keep containers current and only restart them when their image actually changes.</p>
<details class="info">
<summary>Auto-update via labels and a systemd timer</summary>
<ol>
<li>
<p>Add an auto-update label to services in your compose file (both <code>testpoint</code> and <code>certbot</code> if used):</p>
<p><code>yaml
services:
    testpoint:
        # ...
        labels:
            - io.containers.autoupdate=registry
    certbot:
        # ...
        labels:
            - io.containers.autoupdate=registry</code></p>
<p>This instructs Podman to check the registry for newer images and restart only if an update is pulled.</p>
</li>
<li>
<p>Enable the Podman auto-update timer (runs daily by default):</p>
<p><code>bash
systemctl enable --now podman-auto-update.timer</code></p>
</li>
<li>
<p>Run ad-hoc when desired and preview:</p>
<p><code>bash
podman auto-update --dry-run
podman auto-update</code></p>
</li>
<li>
<p>Inspect recent runs:</p>
<p><code>bash
systemctl list-timers | grep podman-auto-update
journalctl -u podman-auto-update --since "1 day ago"</code></p>
</li>
</ol>
</details>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>